/*!For license information please see 765-95dc558f8f831bf2.webpack_chunk.js.LICENSE.txt*/!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dbd2dd21-013a-4158-ae09-32706f89bbdc",e._sentryDebugIdIdentifier="sentry-dbid-dbd2dd21-013a-4158-ae09-32706f89bbdc")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"landing-client@46622c00f9a0b12d592b51a9e585d4d23b404e2c"},(self.webpackChunk=self.webpackChunk||[]).push([[765],{6258:(e,t,n)=>{"use strict";n.d(t,{BH:()=>d,LL:()=>E,ZR:()=>FirebaseError,tV:()=>o,L:()=>s,r3:()=>k,Sg:()=>f,ne:()=>O,vZ:()=>C,ZB:()=>a,pd:()=>x,aH:()=>l,Pz:()=>h,m9:()=>M,z$:()=>p,jU:()=>y,ru:()=>v,xb:()=>A,w1:()=>I,hl:()=>_,uI:()=>m,UG:()=>g,b$:()=>w,G6:()=>b,xO:()=>N,zd:()=>R,eu:()=>T});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},s=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function a(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=a(e[n],t[n]));return e}const c=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,u=()=>{try{return c()||(()=>{if("undefined"==typeof process||void 0==={})return;const e={}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},l=()=>{var e;return null===(e=u())||void 0===e?void 0:e.config},h=e=>{var t;return null===(t=u())||void 0===t?void 0:t[`_${e}`]};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function f(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())}function g(){var e;const t=null===(e=u())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function y(){return"object"==typeof self&&self.self===self}function v(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){const e=p();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function b(){return!g()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class FirebaseError extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(S,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new FirebaseError(r,o,n)}}const S=/\{\$([^}]+)}/g;function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function C(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(D(n)&&D(s)){if(!C(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}function N(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function R(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function x(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function O(e,t){const n=new P(e,t);return n.subscribe.bind(n)}class P{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=L),void 0===r.error&&(r.error=L),void 0===r.complete&&(r.complete=L);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function L(){}function M(e){return e&&e._delegate?e._delegate:e}},292:function(e,t,n){var r;"undefined"!=typeof self&&self,e.exports=(r=n(16996),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=r},function(e,t,n){"use strict";n.r(t),n.d(t,"apiReducer",(function(){return P})),n.d(t,"combineConfigs",(function(){return M})),n.d(t,"middleWare",(function(){return I})),n.d(t,"railsActions",(function(){return L}));let r=0;const i=({resourceConfig:e,config:t,defaultConfig:n={}})=>c(e.optimisticUpdateEnabled)?e.optimisticUpdateEnabled:c(t.resources.optimisticUpdateEnabled)?t.resources.optimisticUpdateEnabled:c(t.optimisticUpdateEnabled)?t.optimisticUpdateEnabled:!c(n.optimisticUpdateEnabled)||n.optimisticUpdateEnabled,s=({controller:e})=>"s"===e[e.length-1]?"collection":"member",o=({config:e,resource:t})=>{const n=e.resources[t].controller;return"collection"===s({controller:n})?"models":"attributes"},a=({config:e,resource:t})=>e.resources[t].idAttribute||"id",c=e=>"boolean"==typeof e,u=({config:e,store:t})=>"function"==typeof e?e(t):e;let l={};const h={SHOW:"GET",INDEX:"GET",CREATE:"POST",UPDATE:"PUT",DESTROY:"DELETE"},d=(e,t)=>`${e}=${encodeURIComponent(t)}`,f=(e,t)=>Array.isArray(t)?((e,t)=>t.map((t=>d(e+"[]",t))))(e,t):d(e,t),p=({baseUrl:e,controller:t,railsAction:n,data:r,queryParams:i={}})=>{const o=s({controller:t}),a=(e=>e.includes("/:id/"))(t),c=()=>a||"collection"===o&&"INDEX"!==n&&"CREATE"!==n?"/"+r.id:"",u=((e={},t)=>{const n=Object.keys(e).filter((t=>void 0!==e[t]||null!==e[t]));return 0===n.length||"GET"!==h[t]?"":"?"+n.map((t=>f(t,e[t]))).join("&")})(i,n);let l;return l=a?`${e}${t}`.replace("/:id",c()):`${e}${t}${c()}`,`${l}${u}`},m=({store:e,resource:t,railsAction:n,error:r,id:i,cId:s,optimisticUpdateEnabled:o,reject:a})=>{const c={type:`${t}.${n}_ERROR`,error:r,id:i,cId:s},u="CREATE"===n;e.dispatch(c),["CREATE","UPDATE"].includes(n)&&o&&e.dispatch({type:t+".UNSET_OPTIMISTIC_DATA",id:i,cId:s,destroy:u}),a(c)},g=({store:e,resource:t,config:n,data:o={},railsAction:c,controllerOverride:u,fetchParamsOverride:l,queryParamsOverride:d,resolve:f,reject:w})=>{const I=n.resources[t],b=I.baseUrl||n.baseUrl,_=u||I.controller,T=a({config:n,resource:t}),E=l||I.fetchParams||n.fetchParams,S=d||I.queryParams||n.queryParams,k=(({railsAction:e,resource:t,config:n,data:r,fetchParams:i={}})=>{const s=h[e],o=new Headers(i.headers||{});let a=Object.assign({},i,{method:s,headers:o});return"object"==typeof r&&"GET"!==s&&(a.body=JSON.stringify(r)),a})({railsAction:c,resource:t,data:o,config:n,fetchParams:E}),A=p({baseUrl:b,controller:_,railsAction:c,data:o,fetchParams:E,queryParams:S}),C=i({resourceConfig:I,config:n});let D;"CREATE"===c&&(D=++r,e.dispatch({type:t+".ASSIGN_CID",cId:D}),e.dispatch({type:t+".SET_LOADING",cId:D})),["CREATE","UPDATE"].includes(c)&&C&&e.dispatch({type:t+".SET_OPTIMISTIC_DATA",id:o.id,cId:D,data:o}),fetch(A,k).then((r=>{r.json().then((i=>{const a=i&&i[T]||o.id;if(!r.ok)return m({store:e,resource:t,railsAction:c,id:a,cId:D,optimisticUpdateEnabled:C,reject:w,error:i.error||{message:r.statusText}});(({store:e,resource:t,railsAction:n,id:r,cId:i,json:o,config:a,controller:c,resolve:u})=>{const l=`${t}.${n}_SUCCESS`,{response:h,metaData:d}=v({json:o,resource:t,config:a,resourceType:s({controller:c})}),f={cId:i,id:r,metaData:d,response:h,type:l};e.dispatch(f),u(f)})({store:e,resource:t,railsAction:c,id:a,cId:D,json:i,config:n,controller:_,optimisticUpdateEnabled:C,resolve:f})})).catch((n=>{const r=n&&n.toString&&n.toString();m({store:e,resource:t,railsAction:c,error:r,id:o.id,cId:D,optimisticUpdateEnabled:C,reject:w})}))})).catch((n=>{m({store:e,resource:t,railsAction:c,error:n,id:o.id,cId:D,optimisticUpdateEnabled:C,reject:w})})).then((()=>(({resource:e})=>{const t=y({resource:e});t.shift(),t.length>0&&g(t[0])})({resource:t})))},y=({resource:e})=>(l[e]||(l[e]={queue:[]}),l[e].queue),v=({json:e,resource:t,config:n,resourceType:r})=>{const i=n.resources[t].parse,s=n.resources[t].setMetadata;let o,a={};switch(typeof i){case"object":{const t=i&&i[r];if(!t){o=e;break}o=t(e);break}case"function":o=i(e);break;default:o=e}switch(typeof s){case"object":{const t=s&&s[r];if(!t)break;a=t(e);break}case"function":a=s(e);break;default:a={}}return{response:o,metaData:a}},w=({action:e,config:t,fetchData:n,next:r,resource:i,resourceConfig:s})=>{const o=new Promise(((e,r)=>{const o={resolve:e,reject:r,...n};(t.disableFetchQueueing||s.disableFetchQueueing)&&g(o),((e,t)=>{const n=y({resource:e});n.push(t),n.length<=1&&g(t)})(i,o)}));return r(e),o};var I=e=>t=>n=>r=>{const i=u({config:e,store:t.getState()}),[s,o]=r.type.split("."),{data:a,controller:c,fetchParams:l}=r,{queryParams:d}=a||{},f={store:t,resource:s,config:i,data:a,railsAction:o,controllerOverride:c,fetchParamsOverride:l,queryParamsOverride:d},p=i.resources[s];return p&&h[o]?w({action:r,config:i,fetchData:f,next:n,resource:s,resourceConfig:p}):n(r)},b=n(0);const _={loading:!1,loadingError:void 0,__prevData:void 0},T=({id:e,cId:t,state:n})=>{let r,i;return(n.models&&n.models.slice(0)||[]).find((n=>(r=void 0!==n.id,i=void 0!==t,r&&n.id===e||i&&n.cId===t)))},E=({id:e,cId:t,metaData:n,attributes:r={}})=>{let i={id:e,cId:t,attributes:{...r}};return Object.keys(i).forEach((e=>void 0===i[e]?delete i[e]:"")),{..._,...n,...i}},S=({metaData:e,models:t=[]})=>({..._,...e,models:t}),k=({state:e,model:t})=>[...e.models||[],t],A=({id:e,cId:t,state:n,updatedModel:r})=>{let i,s;return(n.models&&n.models.slice(0)||[]).map((n=>(i=void 0!==n.id,s=void 0!==t,i&&n.id===e||s&&n.cId===t?r:n)))},C=({id:e,data:t,metaData:n,state:r,cId:i,replaceAttributes:s=!0,replaceMeta:o=!0})=>{const a=T({id:e,cId:i,state:r});let c;return a?(c=s?t:{...a.attributes,...t},!i&&a.cId&&(i=a.cId),A({id:e,cId:i,state:r,updatedModel:E({id:e,cId:i,metaData:n,attributes:c})})):k({state:r,model:E({id:e,cId:i,metaData:n,attributes:t})})},D=({id:e,state:t})=>t.models.filter((t=>t.id!==e)),N=({cId:e,state:t})=>t.models.filter((t=>t.cId!==e)),R=({id:e,cId:t,state:n,queryParams:r})=>{const i=T({id:e,cId:t,state:n});return i?A({id:e,cId:t,state:n,updatedModel:E({id:e,cId:t,metaData:{loading:!0,queryParams:r},attributes:i.attributes})}):k({state:n,model:E({id:e,cId:t,metaData:{loading:!0,queryParams:r}})})},x=({id:e,cId:t,state:n,error:r})=>{const i=T({id:e,cId:t,state:n});return i||e?i?A({id:e,state:n,cId:t,updatedModel:E({...i,metaData:{loadingError:r,__prevData:i.__prevData}})}):k({state:n,model:E({id:e,metaData:{loadingError:r}})}):n.models.slice(0)},O=({config:e,resource:t})=>{const n=o({config:e,resource:t}),r="attributes"===n,i=e.resources[t]||{},s=a({config:e,resource:t});let c;return r?(c=i[n]?i[s]||i.attributes[s]:void 0,E({id:c,idAttribute:s,attributes:i.attributes})):S({models:(i.models||[]).map((e=>E({idAttribute:s,id:e[s],attributes:e})))})};var P=e=>{const t=u({config:e}),n={};return Object.keys(t.resources).forEach((e=>{n[e]=(n=O({config:t,resource:e}),r={})=>{const i=t.resources[e]||{},s="attributes"===o({config:t,resource:e}),c=a({config:t,resource:e}),{queryParams:u}=r.data||{};switch(r.type){case e+".INDEX":{const{paginated:e}=i;return{...n,...S({metaData:{loading:!0,queryParams:u},models:e?n.models:[]})}}case e+".INDEX_SUCCESS":{let{response:t,metaData:s}=r;const o=r.response[e]||r.response[e.toLowerCase()];if(!Array.isArray(r.response)){if(!o||!Array.isArray(o))return console.error("Response to INDEX actions must be of type array OR contain a top-level key matching the resource name with an array as the value. You can use the parse method(s) set in your config for this resource to transform returned data if needed."),{...n,...S({metaData:{loading:!1,loadingError:"Bad data received from server. INDEX calls expect an array."}})};t=o}if(i.paginated){const e=t.reduce(((e,t)=>({...e,[t.id]:t})),{}),r=n.models.map((e=>e.attributes)),i={};t=[...r.map((t=>e[t.id]?(i[t.id]=!0,e[t.id]):t)),...t.filter((e=>!i[e.id]))]}return{...n,...S({models:t.map((e=>E({id:e[c],attributes:e}))),metaData:s})}}case e+".INDEX_ERROR":{const{error:e}=r;return{...n,...S({metaData:{loading:!1,loadingError:e}})}}case e+".SHOW":{const e=r.data||{},{id:t}=e;return s?E({metaData:{loading:!0,queryParams:u},attributes:n.attributes}):{...n,models:R({id:t,state:n,queryParams:u})}}case e+".SHOW_SUCCESS":{const{id:e,response:t,metaData:i}=r,o=t;return s?E({id:e,metaData:i,attributes:{...n.attributes,...o}}):{...n,...S({models:C({id:e,data:o,state:n,metaData:{loading:!1,...i}})})}}case e+".SHOW_ERROR":{const{id:e,error:t}=r;return s?E({id:e,attributes:{...n.attributes},metaData:{loadingError:t}}):{...n,models:x({state:n,id:e,error:t})}}case e+".ASSIGN_CID":{const{cId:e}=r;return s?E({cId:e}):S({models:C({cId:e,state:n})})}case e+".CREATE_SUCCESS":{const{cId:e,id:t,response:i,metaData:o}=r,a=i;return s?E({id:t,cId:e,attributes:{...n.attributes,...a},metaData:o}):S({models:C({data:a,state:n,id:t,cId:e,metaData:o})})}case e+".CREATE_ERROR":{const{id:e,cId:t,error:i}=r;return s?E({id:e,cId:t,metaData:{loadingError:i}}):{...n,models:x({state:n,id:e,cId:t,error:i})}}case e+".UPDATE":{const e=r.data||{},{id:t}=e,i=n.__prevData;return s?E({id:t,metaData:{loading:!0,__prevData:i},attributes:n.attributes}):{...n,models:R({id:t,state:n})}}case e+".UPDATE_SUCCESS":{const{id:e,metaData:t,response:i}=r,o=i;return s?E({id:e,attributes:{...n.attributes,...o},metaData:t}):{...n,models:C({id:e,data:o,metaData:t,state:n,replaceAttributes:!1})}}case e+".UPDATE_ERROR":{const{id:e,error:t}=r;return s?E({id:e,attributes:n.attributes,metaData:{loadingError:t}}):{...n,models:x({state:n,id:e,error:t})}}case e+".DESTROY":{const e=(r.data||{}).id||n.id;return s?E({id:e,attributes:n.attributes,metaData:{loading:!0}}):{...n,models:R({idAttribute:c,id:e,state:n})}}case e+".DESTROY_SUCCESS":{const{id:e}=r;return s?null:{...n,models:D({idAttribute:c,id:e,state:n})}}case e+".DESTROY_ERROR":{const{id:e,error:t}=r;return s?{...n,loading:!1,loadingError:t}:{...n,models:x({state:n,id:e,idAttribute:c,error:t})}}case e+".SET_LOADING":{const{id:e,cId:t}=r;return s?{...n,loading:!0,loadingError:void 0}:{...n,models:R({idAttribute:c,id:e,cId:t,state:n})}}case e+".SET_OPTIMISTIC_DATA":{const{id:e,cId:t,data:i}=r,o=s?n:T({id:e,cId:t,state:n}),a={...o.attributes};let c,u={};return Object.keys(_).forEach((e=>{u[e]=o[e]})),c={...u,__prevData:a},s?E({id:e,cId:t,attributes:{...o.attributes,...i},metaData:c}):S({models:C({data:i,state:n,id:e,cId:t,metaData:c})})}case e+".UNSET_OPTIMISTIC_DATA":{const{id:e,cId:t,destroy:i}=r,o=s?n:T({id:e,cId:t,state:n});return i&&s?null:i?{...n,models:N({cId:t,state:n})}:s?E({id:e,cId:t,attributes:o.__prevData}):S({models:C({data:o.__prevData,state:n,id:e,cId:t})})}default:{const i=t.resources[e];return i&&i.reducer?i.reducer(n,r):n}}}})),Object(b.combineReducers)(n)},L={index:({resource:e,controller:t,queryParams:n})=>({type:e+".INDEX",data:{queryParams:n},controller:t}),show:({id:e,resource:t,controller:n,queryParams:r})=>({type:t+".SHOW",data:{id:e,queryParams:r},controller:n}),update:({id:e,attributes:t,resource:n,controller:r})=>({type:n+".UPDATE",data:{id:e,...t},controller:r}),create:({resource:e,attributes:t,controller:n})=>({type:e+".CREATE",data:t,controller:n}),destroy:({id:e,resource:t,controller:n})=>({type:t+".DESTROY",data:{id:e},controller:n})},M=(...e)=>{const t=u({config:e[0]})||{};let n=Object.assign({},t,{resources:Object.assign({},t.resources)});return e.map((e=>{const n=u({config:e});if(!n.resources)return;const r={};return Object.keys(n.resources||{}).forEach((e=>{const s=n.resources[e];"baseUrl"===e&&"string"==typeof s||"optimisticUpdateEnabled"===e&&c(s)||(r[e]=Object.assign({},s,{baseUrl:s.baseUrl||n.resources.baseUrl||t.baseUrl,optimisticUpdateEnabled:i({resourceConfig:s,config:n,defaultConfig:t})}))})),r})).filter((e=>void 0!==e)).forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];n.resources[t]=Object.assign({},r)}))})),n}}]))},17661:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(6258),i=n(31869),s=n(9001),o=n(71711);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate))))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.LL("app-compat","Firebase",c);const l=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i,o={}){const a=s.initializeApp(i,o);if((0,r.r3)(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=i())=>{if("function"!=typeof e[a])throw u.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw u.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.ZB)(t,e)},createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),t}(),h=new o.Yd("@firebase/app-compat");if((0,r.jU)()&&void 0!==self.firebase){h.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&h.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const d=l;var f;(0,s.registerVersion)("@firebase/app-compat","0.2.3",f)},9001:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FirebaseError:()=>s.ZR,SDK_VERSION:()=>V,_DEFAULT_ENTRY_NAME:()=>k,_addComponent:()=>N,_addOrOverwriteComponent:()=>R,_apps:()=>C,_clearComponents:()=>L,_components:()=>D,_getProvider:()=>O,_registerComponent:()=>x,_removeServiceInstance:()=>P,deleteApp:()=>$,getApp:()=>B,getApps:()=>j,initializeApp:()=>q,onLog:()=>K,registerVersion:()=>G,setLogLevel:()=>z});var r=n(31869),i=n(71711),s=n(6258);let o,a;const c=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function p(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),g(c.get(this))}:function(...t){return g(e.apply(y(this),t))}:function(t,...n){const r=e.call(y(this),t,...n);return l.set(r,t.sort?t.sort():[t]),g(r)}}function m(e){return"function"==typeof e?p(e):(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));u.set(e,t)}(e),t=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,f):e);var t}function g(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(g(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&c.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=m(e);return t!==e&&(h.set(e,t),d.set(t,e)),t}const y=e=>d.get(e);const v=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],I=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(I.get(t))return I.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=w.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!v.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return I.set(t,s),s}f=(e=>({...e,get:(t,n,r)=>b(t,n)||e.get(t,n,r),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(f);class _{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const T="@firebase/app",E="0.9.3",S=new i.Yd("@firebase/app"),k="[DEFAULT]",A={[T]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},C=new Map,D=new Map;function N(e,t){try{e.container.addComponent(t)}catch(n){S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function R(e,t){e.container.addOrOverwriteComponent(t)}function x(e){const t=e.name;if(D.has(t))return S.debug(`There were multiple attempts to register component ${t}.`),!1;D.set(t,e);for(const t of C.values())N(t,e);return!0}function O(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function P(e,t,n=k){O(e,t).clearInstance(n)}function L(){D.clear()}const M={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},F=new s.LL("app","Firebase",M);class U{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw F.create("app-deleted",{appName:this._name})}}const V="9.17.1";function q(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const i=Object.assign({name:k,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!=typeof o||!o)throw F.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.aH)()),!n)throw F.create("no-options");const a=C.get(o);if(a){if((0,s.vZ)(n,a.options)&&(0,s.vZ)(i,a.config))return a;throw F.create("duplicate-app",{appName:o})}const c=new r.H0(o);for(const e of D.values())c.addComponent(e);const u=new U(n,i,c);return C.set(o,u),u}function B(e=k){const t=C.get(e);if(!t&&e===k)return q();if(!t)throw F.create("no-app",{appName:e});return t}function j(){return Array.from(C.values())}async function $(e){const t=e.name;C.has(t)&&(C.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function G(e,t,n){var i;let s=null!==(i=A[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void S.warn(e.join(" "))}x(new r.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function K(e,t){if(null!==e&&"function"!=typeof e)throw F.create("invalid-log-argument");(0,i.Am)(e,t)}function z(e){(0,i.Ub)(e)}const W="firebase-heartbeat-store";let H=null;function Q(){return H||(H=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=g(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(g(o.result),e.oldVersion,e.newVersion,g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(W)}}).catch((e=>{throw F.create("idb-open",{originalErrorMessage:e.message})}))),H}async function Y(e,t){try{const n=(await Q()).transaction(W,"readwrite"),r=n.objectStore(W);return await r.put(t,X(e)),n.done}catch(e){if(e instanceof s.ZR)S.warn(e.message);else{const t=F.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}function X(e){return`${e.name}!${e.options.appId}`}class J{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ee(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Z();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Z(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),te(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),te(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,s.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Z(){return(new Date).toISOString().substring(0,10)}class ee{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){try{return(await Q()).transaction(W).objectStore(W).get(X(e))}catch(e){if(e instanceof s.ZR)S.warn(e.message);else{const t=F.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});S.warn(t.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Y(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Y(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function te(e){return(0,s.L)(JSON.stringify({version:2,heartbeats:e})).length}var ne;ne="",x(new r.wA("platform-logger",(e=>new _(e)),"PRIVATE")),x(new r.wA("heartbeat",(e=>new J(e)),"PRIVATE")),G(T,E,ne),G(T,E,"esm2017"),G("fire-js","")},31869:(e,t,n)=>{"use strict";n.d(t,{wA:()=>i,H0:()=>a});var r=n(6258);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},71711:(e,t,n)=>{"use strict";n.d(t,{in:()=>i,Yd:()=>u,Ub:()=>l,Am:()=>h});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function l(e){r.forEach((t=>{t.setLogLevel(e)}))}function h(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const o=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}},41820:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r.Z});var r=n(17661);r.Z.registerVersion("firebase","9.17.1","app-compat")},60681:(e,t,n)=>{"use strict";var r=n(17661),i=n(6258),s=n(9001),o=n(71711),a=n(321),c=n(31869);const u="facebook.com",l="github.com",h="google.com",d="password",f="twitter.com",p="EMAIL_SIGNIN",m="PASSWORD_RESET",g="RECOVER_EMAIL",y="REVERT_SECOND_FACTOR_ADDITION",v="VERIFY_AND_CHANGE_EMAIL",w="VERIFY_EMAIL";function I(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const b=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},_=I,T=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),E=new o.Yd("@firebase/auth");function S(e,...t){E.logLevel<=o.in.ERROR&&E.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function k(e,...t){throw N(e,...t)}function A(e,...t){return N(e,...t)}function C(e,t,n){const r=Object.assign(Object.assign({},_()),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function D(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&k(e,"argument-error"),C(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function N(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return T.create(e,...t)}function R(e,t,...n){if(!e)throw N(t,...n)}function x(e){const t="INTERNAL ASSERTION FAILED: "+e;throw S(t),new Error(t)}function O(e,t){e||x(t)}const P=new Map;function L(e){O(e instanceof Function,"Expected a class definition");let t=P.get(e);return t?(O(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,P.set(e,t),t)}function M(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function F(){return"http:"===U()||"https:"===U()}function U(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class V{constructor(e,t){this.shortDelay=e,this.longDelay=t,O(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(F()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function q(e,t){O(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class B{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void x("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void x("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void x("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const j={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},$=new V(3e4,6e4);function G(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function K(e,t,n,r,s={}){return z(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),B.fetch()(H(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function z(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},j),t);try{const t=new Q(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Y(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Y(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Y(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Y(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw C(e,a,o);k(e,a)}}catch(t){if(t instanceof i.ZR)throw t;k(e,"network-request-failed")}}async function W(e,t,n,r,i={}){const s=await K(e,t,n,r,i);return"mfaPendingCredential"in s&&k(e,"multi-factor-auth-required",{_serverResponse:s}),s}function H(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?q(e.config,i):`${e.config.apiScheme}://${i}`}class Q{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(A(this.auth,"network-request-failed"))),$.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Y(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=A(e,t,r);return i.customData._tokenResponse=n,i}function X(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function J(e){return 1e3*Number(e)}function Z(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return S("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(S("Failed to decode base64 JWT payload"),null)}catch(e){return S("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function ee(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class te{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ne{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=X(this.lastLoginAt),this.creationTime=X(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function re(e){var t;const n=e.auth,r=await e.getIdToken(),i=await ee(e,async function(e,t){return K(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));R(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=(0,a._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const c=(u=e.providerData,l=o,[...u.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var u,l;const h=e.isAnonymous,d=!(e.email&&s.passwordHash||(null==c?void 0:c.length)),f=!!h&&d,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new ne(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class ie{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){R(e.idToken,"internal-error"),R(void 0!==e.idToken,"internal-error"),R(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Z(e);return R(t,"internal-error"),R(void 0!==t.exp,"internal-error"),R(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return R(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await z(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=H(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",B.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ie;return n&&(R("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(R("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(R("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ie,this.toJSON())}_performRefresh(){return x("not implemented")}}function se(e,t){R("string"==typeof e||void 0===e,"internal-error",{appName:t})}class oe{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,a._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new te(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ne(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ee(this,this.stsTokenManager.getToken(this.auth,e));return R(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=Z(r);R(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:X(J(s.auth_time)),issuedAtTime:X(J(s.iat)),expirationTime:X(J(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await re(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(R(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new oe(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){R(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await re(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ee(this,async function(e,t){return K(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:_}=t;R(v&&_,e,"internal-error");const T=ie.fromJSON(this.name,_);R("string"==typeof v,e,"internal-error"),se(l,e.name),se(h,e.name),R("boolean"==typeof w,e,"internal-error"),R("boolean"==typeof I,e,"internal-error"),se(d,e.name),se(f,e.name),se(p,e.name),se(m,e.name),se(g,e.name),se(y,e.name);const E=new oe({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new ie;r.updateFromServerResponse(t);const i=new oe({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await re(i),i}}class ae{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ae.type="NONE";const ce=ae;function ue(e,t,n){return`firebase:${e}:${t}:${n}`}class le{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=ue(this.userKey,r.apiKey,i),this.fullPersistenceKey=ue("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?oe._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new le(L(ce),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||L(ce);const s=ue(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=oe._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new le(i,e,n)):new le(i,e,n)}}function he(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(me(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(de(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ye(t))return"Blackberry";if(ve(t))return"Webos";if(fe(t))return"Safari";if((t.includes("chrome/")||pe(t))&&!t.includes("edge/"))return"Chrome";if(ge(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function de(e=(0,i.z$)()){return/firefox\//i.test(e)}function fe(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function pe(e=(0,i.z$)()){return/crios\//i.test(e)}function me(e=(0,i.z$)()){return/iemobile/i.test(e)}function ge(e=(0,i.z$)()){return/android/i.test(e)}function ye(e=(0,i.z$)()){return/blackberry/i.test(e)}function ve(e=(0,i.z$)()){return/webos/i.test(e)}function we(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ie(e=(0,i.z$)()){return we(e)||ge(e)||ve(e)||ye(e)||/windows phone/i.test(e)||me(e)}function be(e,t=[]){let n;switch(e){case"Browser":n=he((0,i.z$)());break;case"Worker":n=`${he((0,i.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${r}`}class _e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Te{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Se(this),this.idTokenSubscription=new Se(this),this.beforeStateQueue=new _e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=T,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=L(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await le.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return R(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await re(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&R(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&R(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(L(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&L(e)||this._popupRedirectResolver;R(t,this,"argument-error"),this.redirectPersistenceManager=await le.create(this,[L(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return R(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return R(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=be(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function Ee(e){return(0,i.m9)(e)}class Se{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return R(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ke(e,t,n){const r=Ee(e);R(r._canInitEmulator,r,"emulator-config-failed"),R(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Ae(t),{host:o,port:a}=function(e){const t=Ae(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ce(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ce(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ae(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ce(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class De{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return x("not implemented")}_getIdTokenResponse(e){return x("not implemented")}_linkToIdToken(e,t){return x("not implemented")}_getReauthenticationResolver(e){return x("not implemented")}}async function Ne(e,t){return K(e,"POST","/v1/accounts:resetPassword",G(e,t))}async function Re(e,t){return K(e,"POST","/v1/accounts:update",t)}async function xe(e,t){return K(e,"POST","/v1/accounts:sendOobCode",G(e,t))}class Oe extends De{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Oe(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Oe(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return W(e,"POST","/v1/accounts:signInWithPassword",G(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return W(e,"POST","/v1/accounts:signInWithEmailLink",G(e,t))}(e,{email:this._email,oobCode:this._password});default:k(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Re(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return W(e,"POST","/v1/accounts:signInWithEmailLink",G(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:k(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Pe(e,t){return W(e,"POST","/v1/accounts:signInWithIdp",G(e,t))}class Le extends De{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Le(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):k("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,a._T)(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Le(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Pe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Pe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pe(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const Me={USER_NOT_FOUND:"user-not-found"};class Fe extends De{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return W(e,"POST","/v1/accounts:signInWithPhoneNumber",G(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await W(e,"POST","/v1/accounts:signInWithPhoneNumber",G(e,t));if(n.temporaryProof)throw Y(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return W(e,"POST","/v1/accounts:signInWithPhoneNumber",G(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Me)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Fe({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Ue{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);R(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new Ue(t)}catch(e){return null}}}class Ve{constructor(){this.providerId=Ve.PROVIDER_ID}static credential(e,t){return Oe._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ue.parseLink(t);return R(n,"argument-error"),Oe._fromEmailAndCode(e,n.code,n.tenantId)}}Ve.PROVIDER_ID="password",Ve.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ve.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class qe{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Be extends qe{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class je extends Be{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return R("providerId"in t&&"signInMethod"in t,"argument-error"),Le._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return R(e.idToken||e.accessToken,"argument-error"),Le._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return je.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return je.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new je(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class $e extends Be{constructor(){super("facebook.com")}static credential(e){return Le._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return $e.credential(e.oauthAccessToken)}catch(e){return null}}}$e.FACEBOOK_SIGN_IN_METHOD="facebook.com",$e.PROVIDER_ID="facebook.com";class Ge extends Be{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Le._fromParams({providerId:Ge.PROVIDER_ID,signInMethod:Ge.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ge.credentialFromTaggedObject(e)}static credentialFromError(e){return Ge.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ge.credential(t,n)}catch(e){return null}}}Ge.GOOGLE_SIGN_IN_METHOD="google.com",Ge.PROVIDER_ID="google.com";class Ke extends Be{constructor(){super("github.com")}static credential(e){return Le._fromParams({providerId:Ke.PROVIDER_ID,signInMethod:Ke.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ke.credentialFromTaggedObject(e)}static credentialFromError(e){return Ke.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ke.credential(e.oauthAccessToken)}catch(e){return null}}}Ke.GITHUB_SIGN_IN_METHOD="github.com",Ke.PROVIDER_ID="github.com";class ze extends De{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Pe(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Pe(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pe(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new ze(n,i):null}static _create(e,t){return new ze(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class We extends qe{constructor(e){R(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return We.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return We.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ze.fromJSON(e);return R(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return ze._create(n,t)}catch(e){return null}}}class He extends Be{constructor(){super("twitter.com")}static credential(e,t){return Le._fromParams({providerId:He.PROVIDER_ID,signInMethod:He.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return He.credentialFromTaggedObject(e)}static credentialFromError(e){return He.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return He.credential(t,n)}catch(e){return null}}}async function Qe(e,t){return W(e,"POST","/v1/accounts:signUp",G(e,t))}He.TWITTER_SIGN_IN_METHOD="twitter.com",He.PROVIDER_ID="twitter.com";class Ye{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await oe._fromIdTokenResponse(e,n,r),s=Xe(n);return new Ye({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Xe(n);return new Ye({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Xe(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class MultiFactorError extends i.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new MultiFactorError(e,t,n,r)}}function Je(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw MultiFactorError._fromErrorAndOperation(e,n,t,r);throw n}))}function Ze(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function et(e,t){const n=(0,i.m9)(e);await nt(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return K(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=Ze(r||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function tt(e,t,n=!1){const r=await ee(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ye._forOperation(e,"link",r)}async function nt(e,t,n){await re(t);const r=!1===e?"provider-already-linked":"no-such-provider";R(Ze(t.providerData).has(n)===e,t.auth,r)}async function rt(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await ee(e,Je(r,i,t,e),n);R(s.idToken,r,"internal-error");const o=Z(s.idToken);R(o,r,"internal-error");const{sub:a}=o;return R(e.uid===a,r,"user-mismatch"),Ye._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&k(r,"user-mismatch"),e}}async function it(e,t,n=!1){const r="signIn",i=await Je(e,r,t),s=await Ye._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function st(e,t){return it(Ee(e),t)}async function ot(e,t){const n=(0,i.m9)(e);return await nt(!1,n,t.providerId),tt(n,t)}async function at(e,t){return rt((0,i.m9)(e),t)}async function ct(e,t){const n=Ee(e),r=await async function(e,t){return W(e,"POST","/v1/accounts:signInWithCustomToken",G(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Ye._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class ut{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?lt._fromServerResponse(e,t):k(e,"internal-error")}}class lt extends ut{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new lt(t)}}function ht(e,t,n){var r;R((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),R(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(R(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(R(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function dt(e,t,n){const r=(0,i.m9)(e),s={requestType:"PASSWORD_RESET",email:t};n&&ht(r,s,n),await async function(e,t){return xe(e,t)}(r,s)}async function ft(e,t){await async function(e,t){return K(e,"POST","/v1/accounts:update",G(e,t))}((0,i.m9)(e),{oobCode:t})}async function pt(e,t){const n=(0,i.m9)(e),r=await Ne(n,{oobCode:t}),s=r.requestType;switch(R(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":R(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":R(r.mfaInfo,n,"internal-error");default:R(r.email,n,"internal-error")}let o=null;return r.mfaInfo&&(o=ut._fromServerResponse(Ee(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:o},operation:s}}async function mt(e,t,n){const r=(0,i.m9)(e),s={requestType:"EMAIL_SIGNIN",email:t};R(n.handleCodeInApp,r,"argument-error"),n&&ht(r,s,n),await async function(e,t){return xe(e,t)}(r,s)}async function gt(e,t){const n={identifier:t,continueUri:F()?M():"http://localhost"},{signinMethods:r}=await async function(e,t){return K(e,"POST","/v1/accounts:createAuthUri",G(e,t))}((0,i.m9)(e),n);return r||[]}async function yt(e,t){const n=(0,i.m9)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&ht(n.auth,r,t);const{email:s}=await async function(e,t){return xe(e,t)}(n.auth,r);s!==e.email&&await e.reload()}async function vt(e,t,n){const r=(0,i.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&ht(r.auth,s,n);const{email:o}=await async function(e,t){return xe(e,t)}(r.auth,s);o!==e.email&&await e.reload()}async function wt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=(0,i.m9)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await ee(r,async function(e,t){return K(e,"POST","/v1/accounts:update",t)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find((({providerId:e})=>"password"===e));a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}async function It(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await ee(e,Re(r,i));await e._updateTokensIfNecessary(s,!0)}class bt{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class _t extends bt{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Tt extends bt{constructor(e,t){super(e,"facebook.com",t)}}class Et extends _t{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class St extends bt{constructor(e,t){super(e,"google.com",t)}}class kt extends _t{constructor(e,t,n){super(e,"twitter.com",t,n)}}function At(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=Z(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new bt(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Tt(s,i);case"github.com":return new Et(s,i);case"google.com":return new St(s,i);case"twitter.com":return new kt(s,i,e.screenName||null);case"custom":case"anonymous":return new bt(s,null);default:return new bt(s,r,i)}}(n)}class Ct{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Ct("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ct("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Ct._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Ct._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Dt{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Ee(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>ut._fromServerResponse(n,e)));R(r.mfaPendingCredential,n,"internal-error");const s=Ct._fromMfaPendingCredential(r.mfaPendingCredential);return new Dt(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Ye._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return R(t.user,n,"internal-error"),Ye._forOperation(t.user,t.operationType,o);default:k(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Nt{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>ut._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Nt(e)}async getSession(){return Ct._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await ee(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await ee(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},K(r,"POST","/v2/accounts/mfaEnrollment:withdraw",G(r,i))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,i}}const Rt=new WeakMap;const xt="__sak";class Ot{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(xt,"1"),this.storage.removeItem(xt),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Pt extends Ot{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return fe(e)||we(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Ie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pt.type="LOCAL";const Lt=Pt;class Mt extends Ot{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Mt.type="SESSION";const Ft=Mt;class Ut{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ut(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Vt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Ut.receivers=[];class qt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Vt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Bt(){return window}function jt(){return void 0!==Bt().WorkerGlobalScope&&"function"==typeof Bt().importScripts}const $t="firebaseLocalStorageDb",Gt="firebaseLocalStorage",Kt="fbase_key";class zt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Wt(e,t){return e.transaction([Gt],t?"readwrite":"readonly").objectStore(Gt)}function Ht(){const e=indexedDB.open($t,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Gt,{keyPath:Kt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Gt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase($t);return new zt(e).toPromise()}(),t(await Ht()))}))}))}async function Qt(e,t,n){const r=Wt(e,!0).put({[Kt]:t,value:n});return new zt(r).toPromise()}function Yt(e,t){const n=Wt(e,!0).delete(t);return new zt(n).toPromise()}class Xt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Ht()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ut._getInstance(jt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new qt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ht();return await Qt(e,xt,"1"),await Yt(e,xt),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Qt(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Wt(e,!1).get(t),r=await new zt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Yt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Wt(e,!1).getAll();return new zt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Xt.type="LOCAL";const Jt=Xt;function Zt(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=A("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function en(e){return`__${e}${Math.floor(1e6*Math.random())}`}const tn=1e12;class nn{constructor(e){this.auth=e,this.counter=tn,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new rn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||tn;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||tn;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||tn;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class rn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;R(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const sn=en("rcb"),on=new V(3e4,6e4);class an{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=Bt().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return R(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Bt().grecaptcha):new Promise(((n,r)=>{const s=Bt().setTimeout((()=>{r(A(e,"network-request-failed"))}),on.get());Bt()[sn]=()=>{Bt().clearTimeout(s),delete Bt()[sn];const i=Bt().grecaptcha;if(!i)return void r(A(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)};Zt(`https://www.google.com/recaptcha/api.js??${(0,i.xO)({onload:sn,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(s),r(A(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=Bt().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class cn{async load(e){return new nn(e)}clearedOneInstance(){}}const un="recaptcha",ln={theme:"light",type:"image"};class hn{constructor(e,t=Object.assign({},ln),n){this.parameters=t,this.type=un,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ee(n),this.isInvisible="invisible"===this.parameters.size,R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;R(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new cn:new an,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){R(!this.parameters.sitekey,this.auth,"argument-error"),R(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=Bt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){R(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){R(F()&&!jt(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await K(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);R(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return R(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class dn{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Fe._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function fn(e,t,n){var r;const i=await n.verify();try{let s;if(R("string"==typeof i,e,"argument-error"),R(n.type===un,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){R("enroll"===t.type,e,"internal-error");const n=await function(e,t){return K(e,"POST","/v2/accounts/mfaEnrollment:start",G(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{R("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;R(n,e,"missing-multi-factor-info");const o=await function(e,t){return K(e,"POST","/v2/accounts/mfaSignIn:start",G(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return K(e,"POST","/v1/accounts:sendVerificationCode",G(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class pn{constructor(e){this.providerId=pn.PROVIDER_ID,this.auth=Ee(e)}verifyPhoneNumber(e,t){return fn(this.auth,e,(0,i.m9)(t))}static credential(e,t){return Fe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return pn.credentialFromTaggedObject(t)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Fe._fromTokenResponse(t,n):null}}function mn(e,t){return t?L(t):(R(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}pn.PROVIDER_ID="phone",pn.PHONE_SIGN_IN_METHOD="phone";class gn extends De{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pe(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pe(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pe(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function yn(e){return it(e.auth,new gn(e),e.bypassAuthState)}function vn(e){const{auth:t,user:n}=e;return R(n,t,"internal-error"),rt(n,new gn(e),e.bypassAuthState)}async function wn(e){const{auth:t,user:n}=e;return R(n,t,"internal-error"),tt(n,new gn(e),e.bypassAuthState)}class In{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return yn;case"linkViaPopup":case"linkViaRedirect":return wn;case"reauthViaPopup":case"reauthViaRedirect":return vn;default:k(this.auth,"internal-error")}}resolve(e){O(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){O(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const bn=new V(2e3,1e4);class _n extends In{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,_n.currentPopupAction&&_n.currentPopupAction.cancel(),_n.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return R(e,this.auth,"internal-error"),e}async onExecution(){O(1===this.filter.length,"Popup operations only handle one event");const e=Vt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(A(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(A(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_n.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(A(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,bn.get())};e()}}_n.currentPopupAction=null;const Tn=new Map;class En extends In{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Tn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Cn(t),r=An(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Tn.set(this.auth._key(),e)}return this.bypassAuthState||Tn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Sn(e,t){return An(e)._set(Cn(t),"true")}function kn(e,t){Tn.set(e._key(),t)}function An(e){return L(e._redirectPersistence)}function Cn(e){return ue("pendingRedirect",e.config.apiKey,e.name)}function Dn(e,t,n){return async function(e,t,n){const r=Ee(e);D(e,t,qe),await r._initializationPromise;const i=mn(r,n);return await Sn(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Nn(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);D(r.auth,t,qe),await r.auth._initializationPromise;const s=mn(r.auth,n);await Sn(s,r.auth);const o=await On(r);return s._openRedirect(r.auth,t,"reauthViaRedirect",o)}(e,t,n)}function Rn(e,t,n){return async function(e,t,n){const r=(0,i.m9)(e);D(r.auth,t,qe),await r.auth._initializationPromise;const s=mn(r.auth,n);await nt(!1,r,t.providerId),await Sn(s,r.auth);const o=await On(r);return s._openRedirect(r.auth,t,"linkViaRedirect",o)}(e,t,n)}async function xn(e,t,n=!1){const r=Ee(e),i=mn(r,t),s=new En(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function On(e){const t=Vt(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Pn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Mn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(A(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ln(e))}saveEventToCache(e){this.cachedEventUids.add(Ln(e)),this.lastProcessedEventTime=Date.now()}}function Ln(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Mn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Fn(e,t={}){return K(e,"GET","/v1/projects",t)}const Un=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vn=/^https?/;function qn(e){const t=M(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Vn.test(n))return!1;if(Un.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Bn=new V(3e4,6e4);function jn(){const e=Bt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let $n=null;function Gn(e){return $n=$n||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){jn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{jn(),n(A(e,"network-request-failed"))},timeout:Bn.get()})}if(null===(i=null===(r=Bt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Bt().gapi)||void 0===s?void 0:s.load)){const t=en("iframefcb");return Bt()[t]=()=>{gapi.load?o():n(A(e,"network-request-failed"))},Zt(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw $n=null,e}))}(e),$n}const Kn=new V(5e3,15e3),zn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Wn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Hn(e){const t=e.config;R(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?q(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=Wn.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,i.xO)(r).slice(1)}`}const Qn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Yn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Xn(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Qn),{width:r.toString(),height:s.toString(),top:o,left:a}),l=(0,i.z$)().toLowerCase();n&&(c=pe(l)?"_blank":n),de(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return we(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new Yn(null);const d=window.open(t||"",c,h);R(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Yn(d)}const Jn="__/auth/handler",Zn="emulator/auth/handler";function er(e,t,n,r,o,a){R(e.config.authDomain,e,"auth-domain-config-required"),R(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:s.SDK_VERSION,eventId:o};if(t instanceof qe){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Be){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Jn}`;return q(e,Zn)}(e)}?${(0,i.xO)(u).slice(1)}`}const tr="webStorageSupport";const nr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ft,this._completeRedirectFn=xn,this._overrideRedirectResult=kn}async _openPopup(e,t,n,r){var i;O(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Xn(e,er(e,t,n,M(),r),Vt())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=er(e,t,n,M(),r),Bt().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(O(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Gn(e),n=Bt().gapi;return R(n,e,"internal-error"),t.open({where:document.body,url:Hn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zn,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=A(e,"network-request-failed"),s=Bt().setTimeout((()=>{r(i)}),Kn.get());function o(){Bt().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Pn(e);return t.register("authEvent",(t=>{R(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tr,{type:tr},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),k(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Fn(e);for(const e of t)try{if(qn(e))return}catch(e){}k(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ie()||fe()||we()}};class rr extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return x("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rr(e)}_finalizeEnroll(e,t,n){return function(e,t){return K(e,"POST","/v2/accounts/mfaEnrollment:finalize",G(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return K(e,"POST","/v2/accounts/mfaSignIn:finalize",G(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ir{constructor(){}static assertion(e){return rr._fromCredential(e)}}ir.FACTOR_ID="phone";var sr="@firebase/auth",or="0.21.3";class ar{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){R(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(0,i.Pz)("authIdTokenMaxAge");var cr;function ur(){return window}cr="Browser",(0,s._registerComponent)(new c.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{R(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),R(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:cr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:be(cr)},o=new Te(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(L);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,s._registerComponent)(new c.wA("auth-internal",(e=>(e=>new ar(e))(Ee(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(sr,or,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(cr)),(0,s.registerVersion)(sr,or,"esm2017");async function lr(e,t,n){var r;const{BuildInfo:i}=ur();O(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(O(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return we()?o.ibi=i.packageName:ge()?o.apn=i.packageName:k(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,er(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function hr(e){const{cordova:t}=ur();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,i.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)}))}))}class dr extends Pn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function fr(e){const t=await gr()._get(yr(e));return t&&await gr()._remove(yr(e)),t}function pr(e,t){var n,r;const i=function(e){const t=vr(e),n=t.link?decodeURIComponent(t.link):void 0,r=vr(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return vr(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=vr(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?A(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function mr(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function gr(){return L(Lt)}function yr(e){return ue("authEvent",e.config.apiKey,e.name)}function vr(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,i.zd)(n.join("?"))}const wr=class{constructor(){this._redirectPersistence=Ft,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=xn,this._overrideRedirectResult=kn}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new dr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){k(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=ur();R("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),R(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),R("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Tn.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:mr(),postBody:null,tenantId:e.tenantId,error:A(e,"no-auth-event")}}(e,n,r);await function(e,t){return gr()._set(yr(e),t)}(e,s);const o=await lr(e,s,t);return async function(e,t,n){const{cordova:r}=ur();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(A(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),ge()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await hr(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=ur(),n={};we()?n.iosBundleId=t.packageName:ge()?n.androidPackageName=t.packageName:k(e,"operation-not-supported-in-this-environment"),await Fn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=ur(),s=setTimeout((async()=>{await fr(e),t.onEvent(Ir())}),500),o=async n=>{clearTimeout(s);const r=await fr(e);let i=null;r&&(null==n?void 0:n.url)&&(i=pr(r,n.url)),t.onEvent(i||Ir())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;ur().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function Ir(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:A("no-auth-event")}}function br(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function _r(e=(0,i.z$)()){return!("file:"!==br()&&"ionic:"!==br()&&"capacitor:"!==br()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Tr(e=(0,i.z$)()){return(0,i.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,i.z$)()){return/Edge\/\d+/.test(e)}(e)}function Er(){try{const e=self.localStorage,t=Vt();if(e)return e.setItem(t,"1"),e.removeItem(t),!Tr()||(0,i.hl)()}catch(e){return Sr()&&(0,i.hl)()}return!1}function Sr(){return void 0!==n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function kr(){return("http:"===br()||"https:"===br()||(0,i.ru)()||_r())&&!((0,i.b$)()||(0,i.UG)())&&Er()&&!Sr()}function Ar(){return _r()&&"undefined"!=typeof document}const Cr={LOCAL:"local",NONE:"none",SESSION:"session"},Dr=R,Nr="persistence";async function Rr(e){await e._initializationPromise;const t=xr(),n=ue(Nr,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function xr(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const Or=R;class Pr{constructor(){this.browserResolver=L(nr),this.cordovaResolver=L(wr),this.underlyingResolver=null,this._redirectPersistence=Ft,this._completeRedirectFn=xn,this._overrideRedirectResult=kn}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Ar()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Or(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Ar()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Lr(e){return e.unwrap()}function Mr(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){t.resolver=new qr(e,function(e,t){var n;const r=(0,i.m9)(e),s=t;return R(t.customData.operationType,r,"argument-error"),R(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Dt._fromError(r,s)}(e,t))}else if(r){const e=Fr(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function Fr(e){const{_tokenResponse:t}=e instanceof i.ZR?e.customData:e;if(!t)return null;if(!(e instanceof i.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return pn.credentialFromResult(e);const n=t.providerId;if(!n||n===d)return null;let r;switch(n){case h:r=Ge;break;case u:r=$e;break;case l:r=Ke;break;case f:r=He;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?ze._create(n,o):Le._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new je(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof i.ZR?r.credentialFromError(e):r.credentialFromResult(e)}function Ur(e,t){return t.catch((t=>{throw t instanceof i.ZR&&Mr(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Fr(r)),additionalUserInfo:At(e),user:Br.getOrCreate(n)};var r}))}async function Vr(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Ur(e,n.confirm(t))}}class qr{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ur(Lr(this.auth),this.resolver.resolveSignIn(e))}}class Br{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,i.m9)(e);return Rt.has(t)||Rt.set(t,Nt._fromUser(t)),Rt.get(t)}(e)}static getOrCreate(e){return Br.USER_MAP.has(e)||Br.USER_MAP.set(e,new Br(e)),Br.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ur(this.auth,ot(this._delegate,e))}async linkWithPhoneNumber(e,t){return Vr(this.auth,async function(e,t,n){const r=(0,i.m9)(e);await nt(!1,r,"phone");const s=await fn(r.auth,t,(0,i.m9)(n));return new dn(s,(e=>ot(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Ur(this.auth,async function(e,t,n){const r=(0,i.m9)(e);D(r.auth,t,qe);const s=mn(r.auth,n);return new _n(r.auth,"linkViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Pr))}async linkWithRedirect(e){return await Rr(Ee(this.auth)),Rn(this._delegate,e,Pr)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ur(this.auth,at(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Vr(this.auth,async function(e,t,n){const r=(0,i.m9)(e),s=await fn(r.auth,t,(0,i.m9)(n));return new dn(s,(e=>at(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Ur(this.auth,async function(e,t,n){const r=(0,i.m9)(e);D(r.auth,t,qe);const s=mn(r.auth,n);return new _n(r.auth,"reauthViaPopup",t,s,r).executeNotNull()}(this._delegate,e,Pr))}async reauthenticateWithRedirect(e){return await Rr(Ee(this.auth)),Nn(this._delegate,e,Pr)}sendEmailVerification(e){return yt(this._delegate,e)}async unlink(e){return await et(this._delegate,e),this}updateEmail(e){return function(e,t){return It((0,i.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return It((0,i.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await tt((0,i.m9)(e),t)}(this._delegate,e)}updateProfile(e){return wt(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return vt(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Br.USER_MAP=new WeakMap;const jr=R;class $r{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;jr(n,"invalid-api-key",{appName:e.name}),jr(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Pr:void 0;this._delegate=t.initialize({options:{persistence:Kr(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(b),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Br.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){ke(this._delegate,e,t)}applyActionCode(e){return ft(this._delegate,e)}checkActionCode(e){return pt(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Ne((0,i.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ur(this._delegate,async function(e,t,n){const r=Ee(e),i=await Qe(r,{returnSecureToken:!0,email:t,password:n}),s=await Ye._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return gt(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=Ue.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){jr(kr(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await Ee(e)._initializationPromise,xn(e,t,!1)}(this._delegate,Pr);return e?Ur(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){Ee(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=Gr(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=Gr(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return mt(this._delegate,e,t)}sendPasswordResetEmail(e,t){return dt(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Dr(Object.values(Cr).includes(t),e,"invalid-persistence-type"),(0,i.b$)()?Dr(t!==Cr.SESSION,e,"unsupported-persistence-type"):(0,i.UG)()?Dr(t===Cr.NONE,e,"unsupported-persistence-type"):Sr()?Dr(t===Cr.NONE||t===Cr.LOCAL&&(0,i.hl)(),e,"unsupported-persistence-type"):Dr(t===Cr.NONE||Er(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Cr.SESSION:t=Ft;break;case Cr.LOCAL:t=await L(Jt)._isAvailable()?Jt:Lt;break;case Cr.NONE:t=ce;break;default:return k("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ur(this._delegate,async function(e){var t;const n=Ee(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Ye({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await Qe(n,{returnSecureToken:!0}),i=await Ye._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Ur(this._delegate,st(this._delegate,e))}signInWithCustomToken(e){return Ur(this._delegate,ct(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ur(this._delegate,function(e,t,n){return st((0,i.m9)(e),Ve.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Ur(this._delegate,async function(e,t,n){const r=(0,i.m9)(e),s=Ve.credentialWithLink(t,n||M());return R(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),st(r,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Vr(this._delegate,async function(e,t,n){const r=Ee(e),s=await fn(r,t,(0,i.m9)(n));return new dn(s,(e=>st(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return jr(kr(),this._delegate,"operation-not-supported-in-this-environment"),Ur(this._delegate,async function(e,t,n){const r=Ee(e);D(e,t,qe);const i=mn(r,n);return new _n(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Pr))}async signInWithRedirect(e){return jr(kr(),this._delegate,"operation-not-supported-in-this-environment"),await Rr(this._delegate),Dn(this._delegate,e,Pr)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await pt((0,i.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Gr(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Br.getOrCreate(e)),error:t,complete:n}}function Kr(e,t){const n=function(e,t){const n=xr();if(!n)return[];const r=ue(Nr,e,t);switch(n.getItem(r)){case Cr.NONE:return[ce];case Cr.LOCAL:return[Jt,Ft];case Cr.SESSION:return[Ft];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(Jt)||n.push(Jt),"undefined"!=typeof window)for(const e of[Lt,Ft])n.includes(e)||n.push(e);return n.includes(ce)||n.push(ce),n}$r.Persistence=Cr;class zr{constructor(){this.providerId="phone",this._delegate=new pn(Lr(r.Z.auth()))}static credential(e,t){return pn.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}zr.PHONE_SIGN_IN_METHOD=pn.PHONE_SIGN_IN_METHOD,zr.PROVIDER_ID=pn.PROVIDER_ID;const Wr=R;class Hr{constructor(e,t,n=r.Z.app()){var i;Wr(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new hn(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var Qr;(Qr=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new $r(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:p,PASSWORD_RESET:m,RECOVER_EMAIL:g,REVERT_SECOND_FACTOR_ADDITION:y,VERIFY_AND_CHANGE_EMAIL:v,VERIFY_EMAIL:w}},EmailAuthProvider:Ve,FacebookAuthProvider:$e,GithubAuthProvider:Ke,GoogleAuthProvider:Ge,OAuthProvider:je,SAMLAuthProvider:We,PhoneAuthProvider:zr,PhoneMultiFactorGenerator:ir,RecaptchaVerifier:Hr,TwitterAuthProvider:He,Auth:$r,AuthCredential:De,Error:i.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Qr.registerVersion("@firebase/auth-compat","0.3.3")},15205:(e,t,n)=>{"use strict";var r,i=n(17661),s=n(9001),o=n(31869),a=n(71711),c=n(6258),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},l={},h=h||{},d=u||self;function f(){}function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var g="closure_uid_"+(1e9*Math.random()>>>0),y=0;function v(e,t,n){return e.call.apply(e.bind,arguments)}function w(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:w).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function _(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,g)&&e[g]||(e[g]=++y))},T.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function S(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function k(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(p(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function A(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{d.addEventListener("test",f,t),d.removeEventListener("test",f,t)}catch(e){}return e}();function D(e){return/^[\s\xa0]*$/.test(e)}var N=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function R(e,t){return e<t?-1:e>t?1:0}function x(){var e=d.navigator;return e&&(e=e.userAgent)?e:""}function O(e){return-1!=x().indexOf(e)}function P(e){return P[" "](e),e}P[" "]=f;var L,M,F=O("Opera"),U=O("Trident")||O("MSIE"),V=O("Edge"),q=V||U,B=O("Gecko")&&!(-1!=x().toLowerCase().indexOf("webkit")&&!O("Edge"))&&!(O("Trident")||O("MSIE"))&&!O("Edge"),j=-1!=x().toLowerCase().indexOf("webkit")&&!O("Edge");function $(){var e=d.document;return e?e.documentMode:void 0}e:{var G="",K=(M=x(),B?/rv:([^\);]+)(\)|;)/.exec(M):V?/Edge\/([\d\.]+)/.exec(M):U?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(M):j?/WebKit\/(\S+)/.exec(M):F?/(?:Version)[ \/]?(\S+)/.exec(M):void 0);if(K&&(G=K?K[1]:""),U){var z=$();if(null!=z&&z>parseFloat(G)){L=String(z);break e}}L=G}var W,H={};function Q(){return function(e){var t=H;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=N(String(L)).split("."),n=N("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=R(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||R(0==i[2].length,0==s[2].length)||R(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}))}if(d.document&&U){var Y=$();W=Y||(parseInt(L,10)||void 0)}else W=void 0;var X=W;function J(e,t){if(A.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(B){e:{try{P(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Z[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&J.X.h.call(this)}}_(J,A);var Z={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ee="closure_listenable_"+(1e6*Math.random()|0),te=0;function ne(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++te,this.ba=this.ea=!1}function re(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ie(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function se(e){const t={};for(const n in e)t[n]=e[n];return t}const oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<oe.length;t++)n=oe[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ce(e){this.src=e,this.g={},this.h=0}function ue(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=E(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(re(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function le(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}ce.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=le(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new ne(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var he="closure_lm_"+(1e6*Math.random()|0),de={};function fe(e,t,n,r,i){if(r&&r.once)return me(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)fe(e,t[s],n,r,i);return null}return n=_e(n),e&&e[ee]?e.N(t,n,m(r)?!!r.capture:!!r,i):pe(e,t,n,!1,r,i)}function pe(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=m(i)?!!i.capture:!!i,a=Ie(e);if(a||(e[he]=a=new ce(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=we;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)C||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ve(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function me(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)me(e,t[s],n,r,i);return null}return n=_e(n),e&&e[ee]?e.O(t,n,m(r)?!!r.capture:!!r,i):pe(e,t,n,!0,r,i)}function ge(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ge(e,t[s],n,r,i);else r=m(r)?!!r.capture:!!r,n=_e(n),e&&e[ee]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=le(s=e.g[t],n,r,i))&&(re(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=Ie(e))&&(t=e.g[t.toString()],e=-1,t&&(e=le(t,n,r,i)),(n=-1<e?t[e]:null)&&ye(n))}function ye(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[ee])ue(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ve(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ie(t))?(ue(n,e),0==n.h&&(n.src=null,t[he]=null)):re(e)}}}function ve(e){return e in de?de[e]:de[e]="on"+e}function we(e,t){if(e.ba)e=!0;else{t=new J(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&ye(e),e=n.call(r,t)}return e}function Ie(e){return(e=e[he])instanceof ce?e:null}var be="__closure_events_fn_"+(1e9*Math.random()>>>0);function _e(e){return"function"==typeof e?e:(e[be]||(e[be]=function(t){return e.handleEvent(t)}),e[be])}function Te(){T.call(this),this.i=new ce(this),this.P=this,this.I=null}function Ee(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new A(t,e);else if(t instanceof A)t.target=t.target||e;else{var i=t;ae(t=new A(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Se(o,r,!0,t)&&i}if(i=Se(o=t.g=e,r,!0,t)&&i,i=Se(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Se(o=t.g=n[s],r,!1,t)&&i}function Se(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&ue(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}_(Te,T),Te.prototype[ee]=!0,Te.prototype.removeEventListener=function(e,t,n,r){ge(this,e,t,n,r)},Te.prototype.M=function(){if(Te.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)re(n[r]);delete t.g[e],t.h--}}this.I=null},Te.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Te.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ke=d.JSON.stringify;function Ae(){var e=Pe;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ce,De=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Ne),(e=>e.reset()));class Ne{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Re(e){d.setTimeout((()=>{throw e}),0)}function xe(e,t){Ce||function(){var e=d.Promise.resolve(void 0);Ce=function(){e.then(Le)}}(),Oe||(Ce(),Oe=!0),Pe.add(e,t)}var Oe=!1,Pe=new class{constructor(){this.h=this.g=null}add(e,t){const n=De.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Le(){for(var e;e=Ae();){try{e.h.call(e.g)}catch(e){Re(e)}var t=De;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Oe=!1}function Me(e,t){Te.call(this),this.h=e||1,this.g=t||d,this.j=I(this.lb,this),this.l=Date.now()}function Fe(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Ue(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=I(e.handleEvent,e)}return 2147483647<Number(t)?-1:d.setTimeout(e,t||0)}function Ve(e){e.g=Ue((()=>{e.g=null,e.i&&(e.i=!1,Ve(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}_(Me,Te),(r=Me.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ee(this,"tick"),this.ca&&(Fe(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Me.X.M.call(this),Fe(this),delete this.g};class qe extends T{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ve(this)}M(){super.M(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Be(e){T.call(this),this.h=e,this.g={}}_(Be,T);var je=[];function $e(e,t,n,r){Array.isArray(n)||(n&&(je[0]=n.toString()),n=je);for(var i=0;i<n.length;i++){var s=fe(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ge(e){ie(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ye(e)}),e),e.g={}}function Ke(){this.g=!0}function ze(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ke(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Be.prototype.M=function(){Be.X.M.call(this),Ge(this)},Be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ke.prototype.Aa=function(){this.g=!1},Ke.prototype.info=function(){};var We={},He=null;function Qe(){return He=He||new Te}function Ye(e){A.call(this,We.Pa,e)}function Xe(e){const t=Qe();Ee(t,new Ye(t))}function Je(e,t){A.call(this,We.STAT_EVENT,e),this.stat=t}function Ze(e){const t=Qe();Ee(t,new Je(t,e))}function et(e,t){A.call(this,We.Qa,e),this.size=t}function tt(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return d.setTimeout((function(){e()}),t)}We.Pa="serverreachability",_(Ye,A),We.STAT_EVENT="statevent",_(Je,A),We.Qa="timingevent",_(et,A);var nt={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},rt={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function it(){}function st(e){return e.h||(e.h=e.i())}function ot(){}it.prototype.h=null;var at,ct={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ut(){A.call(this,"d")}function lt(){A.call(this,"c")}function ht(){}function dt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Be(this),this.O=pt,e=q?125:void 0,this.T=new Me(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ft}function ft(){this.i=null,this.g="",this.h=!1}_(ut,A),_(lt,A),_(ht,it),ht.prototype.g=function(){return new XMLHttpRequest},ht.prototype.i=function(){return{}},at=new ht;var pt=45e3,mt={},gt={};function yt(e,t,n){e.K=1,e.v=Mt(Rt(t)),e.s=n,e.P=!0,vt(e,null)}function vt(e,t){e.F=Date.now(),_t(e),e.A=Rt(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Qt(n.i,"t",r),e.C=0,n=e.l.H,e.h=new ft,e.g=Qn(e.l,n?t:null,!e.s),0<e.N&&(e.L=new qe(I(e.La,e,e.g),e.N)),$e(e.S,e.g,"readystatechange",e.ib),t=e.H?se(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Xe(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function wt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function It(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=bt(e,n),r==gt){4==t&&(e.o=4,Ze(14),i=!1),ze(e.j,e.m,null,"[Incomplete Response]");break}if(r==mt){e.o=4,Ze(15),ze(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}ze(e.j,e.m,r,null),At(e,r)}wt(e)&&r!=gt&&r!=mt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Ze(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Bn(t),t.K=!0,Ze(11))):(ze(e.j,e.m,n,"[Invalid Chunked Response]"),kt(e),St(e))}function bt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?gt:(n=Number(t.substring(n,r)),isNaN(n)?mt:(r+=1)+n>t.length?gt:(t=t.substr(r,n),e.C=r+n,t))}function _t(e){e.V=Date.now()+e.O,Tt(e,e.O)}function Tt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=tt(I(e.gb,e),t)}function Et(e){e.B&&(d.clearTimeout(e.B),e.B=null)}function St(e){0==e.l.G||e.I||Gn(e.l,e)}function kt(e){Et(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Fe(e.T),Ge(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function At(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||tn(n.h,e)))if(!e.J&&tn(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;$n(n),On(n)}qn(n),Ze(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=tt(I(n.cb,n),6e3));if(1>=en(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else zn(n,11)}else if((e.J||n.g==e)&&$n(n),!D(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(nn(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,Lt(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((r=n).sa=Hn(r,r.H?r.ka:null,r.V),o.J){rn(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(Et(a),_t(a)),r.g=o}else Vn(r);0<n.i.length&&Ln(n)}else"stop"!=u[0]&&"close"!=u[0]||zn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?zn(n,7):xn(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}Xe()}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(p(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(r=dt.prototype).setTimeout=function(e){this.O=e},r.ib=function(e){e=e.target;const t=this.L;t&&3==kn(e)?t.l():this.La(e)},r.La=function(e){try{if(e==this.g)e:{const l=kn(this.g);var t=this.g.Ea();this.g.aa();if(!(3>l)&&(3!=l||q||this.g&&(this.h.h||this.g.fa()||An(this.g)))){this.I||4!=l||7==t||Xe(),Et(this);var n=this.g.aa();this.Y=n;t:if(wt(this)){var r=An(this.g);e="";var i=r.length,s=4==kn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){kt(this),St(this);var o="";break t}this.h.i=new d.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.U,l,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Ze(12),kt(this),St(this);break e}ze(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,At(this,n)}this.P?(It(this,l,o),q&&this.i&&3==l&&($e(this.S,this.T,"tick",this.hb),this.T.start())):(ze(this.j,this.m,o,null),At(this,o)),4==l&&kt(this),this.i&&!this.I&&(4==l?Gn(this.l,this):(this.i=!1,_t(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Ze(12)):(this.o=0,Ze(13)),kt(this),St(this)}}}catch(e){}},r.hb=function(){if(this.g){var e=kn(this.g),t=this.g.fa();this.C<t.length&&(Et(this),It(this,e,t),this.i&&4!=e&&_t(this))}},r.cancel=function(){this.I=!0,kt(this)},r.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Xe(),Ze(17)),kt(this),this.o=2,St(this)):Tt(this,this.V-e)};var Dt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Nt(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Nt){this.h=void 0!==t?t:e.h,xt(this,e.j),this.s=e.s,this.g=e.g,Ot(this,e.m),this.l=e.l,t=e.i;var n=new Kt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Pt(this,n),this.o=e.o}else e&&(n=String(e).match(Dt))?(this.h=!!t,xt(this,n[1]||"",!0),this.s=Ft(n[2]||""),this.g=Ft(n[3]||"",!0),Ot(this,n[4]),this.l=Ft(n[5]||"",!0),Pt(this,n[6]||"",!0),this.o=Ft(n[7]||"")):(this.h=!!t,this.i=new Kt(null,this.h))}function Rt(e){return new Nt(e)}function xt(e,t,n){e.j=n?Ft(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Pt(e,t,n){t instanceof Kt?(e.i=t,function(e,t){t&&!e.j&&(zt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Wt(this,t),Qt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ut(t,$t)),e.i=new Kt(t,e.h))}function Lt(e,t,n){e.i.set(t,n)}function Mt(e){return Lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ft(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ut(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Vt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Vt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Nt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ut(t,qt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ut(t,qt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ut(n,"/"==n.charAt(0)?jt:Bt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ut(n,Gt)),e.join("")};var qt=/[#\/\?@]/g,Bt=/[#\?:]/g,jt=/[#\?]/g,$t=/[#\?@]/g,Gt=/#/g;function Kt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function zt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Wt(e,t){zt(e),t=Yt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ht(e,t){return zt(e),t=Yt(e,t),e.g.has(t)}function Qt(e,t,n){Wt(e,t),0<n.length&&(e.i=null,e.g.set(Yt(e,t),S(n)),e.h+=n.length)}function Yt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=Kt.prototype).add=function(e,t){zt(this),this.i=null,e=Yt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){zt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.oa=function(){zt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.W=function(e){zt(this);let t=[];if("string"==typeof e)Ht(this,e)&&(t=t.concat(this.g.get(Yt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return zt(this),this.i=null,Ht(this,e=Yt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};function Xt(e){this.l=e||Jt,d.PerformanceNavigationTiming?e=0<(e=d.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(d.g&&d.g.Ga&&d.g.Ga()&&d.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Jt=10;function Zt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function en(e){return e.h?1:e.g?e.g.size:0}function tn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function nn(e,t){e.g?e.g.add(t):e.h=t}function rn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function sn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return S(e.i)}function on(){}function an(){this.g=new on}function cn(e,t,n){const r=n||"";try{Ct(e,(function(e,n){let i=e;m(e)&&(i=ke(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function un(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ln(e){this.l=e.ac||null,this.j=e.jb||!1}function hn(e,t){Te.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=dn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Xt.prototype.cancel=function(){if(this.i=sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},on.prototype.stringify=function(e){return d.JSON.stringify(e,void 0)},on.prototype.parse=function(e){return d.JSON.parse(e,void 0)},_(ln,it),ln.prototype.g=function(){return new hn(this.l,this.j)},ln.prototype.i=function(e){return function(){return e}}({}),_(hn,Te);var dn=0;function fn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function pn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,mn(e)}function mn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=hn.prototype).open=function(e,t){if(this.readyState!=dn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,mn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||d).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,pn(this)),this.readyState=dn},r.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,mn(this)),this.g&&(this.readyState=3,mn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==d.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;fn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?pn(this):mn(this),3==this.readyState&&fn(this)}},r.Va=function(e){this.g&&(this.response=this.responseText=e,pn(this))},r.Ua=function(e){this.g&&(this.response=e,pn(this))},r.ga=function(){this.g&&pn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(hn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var gn=d.JSON.parse;function yn(e){Te.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=vn,this.K=this.L=!1}_(yn,Te);var vn="",wn=/^https?$/i,In=["POST","PUT"];function bn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,_n(e),En(e)}function _n(e){e.D||(e.D=!0,Ee(e,"complete"),Ee(e,"error"))}function Tn(e){if(e.h&&void 0!==h&&(!e.C[1]||4!=kn(e)||2!=e.aa()))if(e.v&&4==kn(e))Ue(e.Ha,0,e);else if(Ee(e,"readystatechange"),4==kn(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Dt)[1]||null;if(!i&&d.self&&d.self.location){var s=d.self.location.protocol;i=s.substr(0,s.length-1)}r=!wn.test(i?i.toLowerCase():"")}n=r}if(n)Ee(e,"complete"),Ee(e,"success");else{e.m=6;try{var o=2<kn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",_n(e)}}finally{En(e)}}}function En(e,t){if(e.g){Sn(e);const n=e.g,r=e.C[0]?f:null;e.g=null,e.C=null,t||Ee(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Sn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(d.clearTimeout(e.A),e.A=null)}function kn(e){return e.g?e.g.readyState:0}function An(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case vn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(e){let t="";return ie(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Dn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Cn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Lt(e,t,n))}function Nn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Rn(e){this.Ca=0,this.i=[],this.j=new Ke,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Nn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Nn("baseRetryDelayMs",5e3,e),this.bb=Nn("retryDelaySeedMs",1e4,e),this.$a=Nn("forwardChannelMaxRetries",2,e),this.ta=Nn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Xt(e&&e.concurrentRequestLimit),this.Fa=new an,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function xn(e){if(Pn(e),3==e.G){var t=e.U++,n=Rt(e.F);Lt(n,"SID",e.I),Lt(n,"RID",t),Lt(n,"TYPE","terminate"),Fn(e,n),(t=new dt(e,e.j,t,void 0)).K=2,t.v=Mt(Rt(n)),n=!1,d.navigator&&d.navigator.sendBeacon&&(n=d.navigator.sendBeacon(t.v.toString(),"")),!n&&d.Image&&((new Image).src=t.v,n=!0),n||(t.g=Qn(t.l,null),t.g.da(t.v)),t.F=Date.now(),_t(t)}Wn(e)}function On(e){e.g&&(Bn(e),e.g.cancel(),e.g=null)}function Pn(e){On(e),e.u&&(d.clearTimeout(e.u),e.u=null),$n(e),e.h.cancel(),e.m&&("number"==typeof e.m&&d.clearTimeout(e.m),e.m=null)}function Ln(e){Zt(e.h)||e.m||(e.m=!0,xe(e.Ja,e),e.C=0)}function Mn(e,t){var n;n=t?t.m:e.U++;const r=Rt(e.F);Lt(r,"SID",e.I),Lt(r,"RID",n),Lt(r,"AID",e.T),Fn(e,r),e.o&&e.s&&Dn(r,e.o,e.s),n=new dt(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Un(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),nn(e.h,n),yt(n,r,t)}function Fn(e,t){e.ia&&ie(e.ia,(function(e,n){Lt(t,n,e)})),e.l&&Ct({},(function(e,n){Lt(t,n,e)}))}function Un(e,t,n){n=Math.min(e.i.length,n);var r=e.l?I(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{cn(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Vn(e){e.g||e.u||(e.Z=1,xe(e.Ia,e),e.A=0)}function qn(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=tt(I(e.Ia,e),Kn(e,e.A)),e.A++,!0)}function Bn(e){null!=e.B&&(d.clearTimeout(e.B),e.B=null)}function jn(e){e.g=new dt(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Rt(e.sa);Lt(t,"RID","rpc"),Lt(t,"SID",e.I),Lt(t,"CI",e.L?"0":"1"),Lt(t,"AID",e.T),Lt(t,"TYPE","xmlhttp"),Fn(e,t),e.o&&e.s&&Dn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Mt(Rt(t)),n.s=null,n.P=!0,vt(n,e)}function $n(e){null!=e.v&&(d.clearTimeout(e.v),e.v=null)}function Gn(e,t){var n=null;if(e.g==t){$n(e),Bn(e),e.g=null;var r=2}else{if(!tn(e.h,t))return;n=t.D,rn(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ee(r=Qe(),new et(r,n)),Ln(e)}else Vn(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(en(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=tt(I(e.Ja,e,t),Kn(e,e.C)),e.C++,0)))}(e,t)||2==r&&qn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:zn(e,5);break;case 4:zn(e,10);break;case 3:zn(e,6);break;default:zn(e,2)}}function Kn(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function zn(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=I(e.kb,e);n||(n=new Nt("//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||xt(n,"https"),Mt(n)),function(e,t){const n=new Ke;if(d.Image){const r=new Image;r.onload=b(un,n,r,"TestLoadImage: loaded",!0,t),r.onerror=b(un,n,r,"TestLoadImage: error",!1,t),r.onabort=b(un,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=b(un,n,r,"TestLoadImage: timeout",!1,t),d.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Ze(2);e.G=0,e.l&&e.l.va(t),Wn(e),Pn(e)}function Wn(e){if(e.G=0,e.la=[],e.l){const t=sn(e.h);0==t.length&&0==e.i.length||(k(e.la,t),k(e.la,e.i),e.h.i.length=0,S(e.i),e.i.length=0),e.l.ua()}}function Hn(e,t,n){var r=n instanceof Nt?Rt(n):new Nt(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Ot(r,r.m);else{var i=d.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Nt(null,void 0);r&&xt(s,r),t&&(s.g=t),i&&Ot(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&Lt(r,n,t),Lt(r,"VER",e.ma),Fn(e,r),r}function Qn(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new yn(new ln({jb:!0})):new yn(e.ra)).Ka(e.H),t}function Yn(){}function Xn(){if(U&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function Jn(e,t){Te.call(this),this.g=new Rn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!D(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new tr(this)}function Zn(e){ut.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function er(){lt.call(this),this.status=1}function tr(e){this.g=e}(r=yn.prototype).Ka=function(e){this.L=e},r.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():at.g(),this.C=this.u?st(this.u):st(at),this.g.onreadystatechange=I(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void bn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=d.FormData&&e instanceof d.FormData,!(0<=E(In,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Sn(this),0<this.B&&((this.K=function(e){return U&&Q()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=I(this.qa,this)):this.A=Ue(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){bn(this,e)}},r.qa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ee(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ee(this,"complete"),Ee(this,"abort"),En(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),En(this,!0)),yn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?Tn(this):this.fb())},r.fb=function(){Tn(this)},r.aa=function(){try{return 2<kn(this)?this.g.status:-1}catch(e){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),gn(t)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Rn.prototype).ma=8,r.G=1,r.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new dt(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=se(s),ae(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Un(this,i,t),Lt(n=Rt(this.F),"RID",e),Lt(n,"CVER",22),this.D&&Lt(n,"X-HTTP-Session-Id",this.D),Fn(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Cn(s)))+"&"+t:this.o&&Dn(n,this.o,s)),nn(this.h,i),this.Ya&&Lt(n,"TYPE","init"),this.O?(Lt(n,"$req",t),Lt(n,"SID","null"),i.Z=!0,yt(i,n,null)):yt(i,n,t),this.G=2}}else 3==this.G&&(e?Mn(this,e):0==this.i.length||Zt(this.h)||Mn(this))},r.Ia=function(){if(this.u=null,jn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=tt(I(this.eb,this),e)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ze(10),On(this),jn(this))},r.cb=function(){null!=this.v&&(this.v=null,On(this),qn(this),Ze(19))},r.kb=function(e){e?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))},(r=Yn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Xn.prototype.g=function(e,t){return new Jn(e,t)},_(Jn,Te),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;Ze(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=Hn(e,null,e.V),Ln(e)},Jn.prototype.close=function(){xn(this.g)},Jn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ke(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&Ln(t)},Jn.prototype.M=function(){this.g.l=null,delete this.j,xn(this.g),delete this.g,Jn.X.M.call(this)},_(Zn,ut),_(er,lt),_(tr,Yn),tr.prototype.xa=function(){Ee(this.g,"a")},tr.prototype.wa=function(e){Ee(this.g,new Zn(e))},tr.prototype.va=function(e){Ee(this.g,new er)},tr.prototype.ua=function(){Ee(this.g,"b")},Xn.prototype.createWebChannel=Xn.prototype.g,Jn.prototype.send=Jn.prototype.u,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,nt.NO_ERROR=0,nt.TIMEOUT=8,nt.HTTP_ERROR=6,rt.COMPLETE="complete",ot.EventType=ct,ct.OPEN="a",ct.CLOSE="b",ct.ERROR="c",ct.MESSAGE="d",Te.prototype.listen=Te.prototype.N,yn.prototype.listenOnce=yn.prototype.O,yn.prototype.getLastError=yn.prototype.Oa,yn.prototype.getLastErrorCode=yn.prototype.Ea,yn.prototype.getStatus=yn.prototype.aa,yn.prototype.getResponseJson=yn.prototype.Sa,yn.prototype.getResponseText=yn.prototype.fa,yn.prototype.send=yn.prototype.da,yn.prototype.setWithCredentials=yn.prototype.Ka;var nr=l.createWebChannelTransport=function(){return new Xn},rr=l.getStatEventTarget=function(){return Qe()},ir=l.ErrorCode=nt,sr=l.EventType=rt,or=l.Event=We,ar=l.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},cr=l.FetchXmlHttpFactory=ln,ur=l.WebChannel=ot,lr=l.XhrIo=yn;const hr="@firebase/firestore";class dr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}dr.UNAUTHENTICATED=new dr(null),dr.GOOGLE_CREDENTIALS=new dr("google-credentials-uid"),dr.FIRST_PARTY=new dr("first-party-uid"),dr.MOCK_USER=new dr("mock-user");let fr="9.17.1";const pr=new a.Yd("@firebase/firestore");function mr(){return pr.logLevel}function gr(e,...t){if(pr.logLevel<=a.in.DEBUG){const n=t.map(wr);pr.debug(`Firestore (${fr}): ${e}`,...n)}}function yr(e,...t){if(pr.logLevel<=a.in.ERROR){const n=t.map(wr);pr.error(`Firestore (${fr}): ${e}`,...n)}}function vr(e,...t){if(pr.logLevel<=a.in.WARN){const n=t.map(wr);pr.warn(`Firestore (${fr}): ${e}`,...n)}}function wr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ir(e="Unexpected state"){const t=`FIRESTORE (${fr}) INTERNAL ASSERTION FAILED: `+e;throw yr(t),new Error(t)}function br(e,t){e||Ir()}function _r(e,t){return e}const Tr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Er extends c.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Sr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class kr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ar{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(dr.UNAUTHENTICATED)))}shutdown(){}}class Cr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Dr{constructor(e){this.t=e,this.currentUser=dr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Sr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Sr,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{gr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(gr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Sr)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(gr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(br("string"==typeof t.accessToken),new kr(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return br(null===e||"string"==typeof e),new dr(e)}}class Nr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=dr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(br(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Rr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Nr(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(dr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class xr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Or{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&gr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,gr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{gr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):gr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(br("string"==typeof e.token),this.A=e.token,new xr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Pr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Lr{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Pr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Mr(e,t){return e<t?-1:e>t?1:0}function Fr(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Ur(e){return e+"\0"}class Vr{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Er(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Er(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Er(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Er(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Vr.fromMillis(Date.now())}static fromDate(e){return Vr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Vr(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Mr(this.nanoseconds,e.nanoseconds):Mr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class qr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new qr(e)}static min(){return new qr(new Vr(0,0))}static max(){return new qr(new Vr(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Br{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ir(),void 0===n?n=e.length-t:n>e.length-t&&Ir(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Br.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Br?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class jr extends Br{construct(e,t,n){return new jr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Er(Tr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new jr(t)}static emptyPath(){return new jr([])}}const $r=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gr extends Br{construct(e,t,n){return new Gr(e,t,n)}static isValidIdentifier(e){return $r.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Gr(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Er(Tr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Er(Tr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Er(Tr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Er(Tr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gr(t)}static emptyPath(){return new Gr([])}}class Kr{constructor(e){this.path=e}static fromPath(e){return new Kr(jr.fromString(e))}static fromName(e){return new Kr(jr.fromString(e).popFirst(5))}static empty(){return new Kr(jr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===jr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return jr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Kr(new jr(e.slice()))}}class zr{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Wr(e){return e.fields.find((e=>2===e.kind))}function Hr(e){return e.fields.filter((e=>2!==e.kind))}zr.UNKNOWN_ID=-1;class Qr{constructor(e,t){this.fieldPath=e,this.kind=t}}class Yr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Yr(0,Zr.min())}}function Xr(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=qr.fromTimestamp(1e9===r?new Vr(n+1,0):new Vr(n,r));return new Zr(i,Kr.empty(),t)}function Jr(e){return new Zr(e.readTime,e.key,-1)}class Zr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Zr(qr.min(),Kr.empty(),-1)}static max(){return new Zr(qr.max(),Kr.empty(),-1)}}function ei(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Kr.comparator(e.documentKey,t.documentKey),0!==n?n:Mr(e.largestBatchId,t.largestBatchId))}const ti="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ni{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ri(e){if(e.code!==Tr.FAILED_PRECONDITION||e.message!==ti)throw e;gr("LocalStore","Unexpectedly lost primary lease")}class ii{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ir(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ii(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ii?t:ii.resolve(t)}catch(e){return ii.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ii.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ii.reject(t)}static resolve(e){return new ii(((t,n)=>{t(e)}))}static reject(e){return new ii(((t,n)=>{n(e)}))}static waitFor(e){return new ii(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ii.resolve(!1);for(const n of e)t=t.next((e=>e?ii.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ii(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ii(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class si{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Sr,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new ci(e,t.error)):this.P.resolve()},this.transaction.onerror=t=>{const n=fi(t.target.error);this.P.reject(new ci(e,n))}}static open(e,t,n,r){try{return new si(t,e.transaction(r,n))}catch(e){throw new ci(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(gr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new li(t)}}class oi{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===oi.D((0,c.z$)())&&yr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return gr("SimpleDb","Removing database:",e),hi(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,c.hl)())return!1;if(oi.N())return!0;const e=(0,c.z$)(),t=oi.D(e),n=0<t&&t<10,r=oi.k(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={})||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(e){return this.db||(gr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ci(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Er(Tr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Er(Tr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ci(e,r))},r.onupgradeneeded=e=>{gr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next((()=>{gr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=si.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.V(),e))).catch((e=>(t.abort(e),ii.reject(e)))).toPromise();return s.catch((()=>{})),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(gr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ai{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return hi(this.q.delete())}}class ci extends Er{constructor(e,t){super(Tr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ui(e){return"IndexedDbTransactionError"===e.name}class li{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(gr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(gr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),hi(n)}add(e){return gr("SimpleDb","ADD",this.store.name,e,e),hi(this.store.add(e))}get(e){return hi(this.store.get(e)).next((t=>(void 0===t&&(t=null),gr("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return gr("SimpleDb","DELETE",this.store.name,e),hi(this.store.delete(e))}count(){return gr("SimpleDb","COUNT",this.store.name),hi(this.store.count())}W(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.H(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new ii(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}J(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ii(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}Y(e,t){gr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const r=this.cursor(n);return this.H(r,((e,t,n)=>n.delete()))}Z(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}tt(e){const t=this.cursor({});return new ii(((n,r)=>{t.onerror=e=>{const t=fi(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}H(e,t){const n=[];return new ii(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ai(i),o=t(i.primaryKey,i.value,s);if(o instanceof ii){const e=o.catch((e=>(s.done(),ii.reject(e))));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}})).next((()=>ii.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function hi(e){return new ii(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=fi(e.target.error);n(t)}}))}let di=!1;function fi(e){const t=oi.D((0,c.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Er("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return di||(di=!0,setTimeout((()=>{throw e}),0)),e}}return e}class pi{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){gr("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{gr("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){ui(e)?gr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ri(e)}await this.nt(6e4)}))}}class mi{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.it(t,e)))}it(e,t){const n=new Set;let r=t,i=!0;return ii.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return gr("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ot(r,n))).next((n=>(gr("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ot(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=Jr(t);ei(r,n)>0&&(n=r)})),new Zr(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class gi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}gi.at=-1;class yi{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class vi{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof vi&&e.projectId===this.projectId&&e.database===this.database}}function wi(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ii(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function bi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function _i(e){return null==e}function Ti(e){return 0===e&&1/e==-1/0}function Ei(e){return"number"==typeof e&&Number.isInteger(e)&&!Ti(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Si{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Si(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Si(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Mr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Si.EMPTY_BYTE_STRING=new Si("");const ki=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ai(e){if(br(!!e),"string"==typeof e){let t=0;const n=ki.exec(e);if(br(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ci(e.seconds),nanos:Ci(e.nanos)}}function Ci(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Di(e){return"string"==typeof e?Si.fromBase64String(e):Si.fromUint8Array(e)}function Ni(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ri(e){const t=e.mapValue.fields.__previous_value__;return Ni(t)?Ri(t):t}function xi(e){const t=Ai(e.mapValue.fields.__local_write_time__.timestampValue);return new Vr(t.seconds,t.nanos)}const Oi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Pi={nullValue:"NULL_VALUE"};function Li(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ni(e)?4:Qi(e)?9007199254740991:10:Ir()}function Mi(e,t){if(e===t)return!0;const n=Li(e);if(n!==Li(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return xi(e).isEqual(xi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ai(e.timestampValue),r=Ai(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Di(e.bytesValue).isEqual(Di(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ci(e.geoPointValue.latitude)===Ci(t.geoPointValue.latitude)&&Ci(e.geoPointValue.longitude)===Ci(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ci(e.integerValue)===Ci(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ci(e.doubleValue),r=Ci(t.doubleValue);return n===r?Ti(n)===Ti(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Fr(e.arrayValue.values||[],t.arrayValue.values||[],Mi);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(wi(n)!==wi(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Mi(n[e],r[e])))return!1;return!0}(e,t);default:return Ir()}}function Fi(e,t){return void 0!==(e.values||[]).find((e=>Mi(e,t)))}function Ui(e,t){if(e===t)return 0;const n=Li(e),r=Li(t);if(n!==r)return Mr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Mr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ci(e.integerValue||e.doubleValue),r=Ci(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Vi(e.timestampValue,t.timestampValue);case 4:return Vi(xi(e),xi(t));case 5:return Mr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Di(e),r=Di(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Mr(n[e],r[e]);if(0!==t)return t}return Mr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Mr(Ci(e.latitude),Ci(t.latitude));return 0!==n?n:Mr(Ci(e.longitude),Ci(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Ui(n[e],r[e]);if(t)return t}return Mr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Oi.mapValue&&t===Oi.mapValue)return 0;if(e===Oi.mapValue)return 1;if(t===Oi.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Mr(r[e],s[e]);if(0!==t)return t;const o=Ui(n[r[e]],i[s[e]]);if(0!==o)return o}return Mr(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Ir()}}function Vi(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Mr(e,t);const n=Ai(e),r=Ai(t),i=Mr(n.seconds,r.seconds);return 0!==i?i:Mr(n.nanos,r.nanos)}function qi(e){return Bi(e)}function Bi(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ai(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Di(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Kr.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Bi(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Bi(e.fields[i])}`;return n+"}"}(e.mapValue):Ir();var t,n}function ji(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function $i(e){return!!e&&"integerValue"in e}function Gi(e){return!!e&&"arrayValue"in e}function Ki(e){return!!e&&"nullValue"in e}function zi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Wi(e){return!!e&&"mapValue"in e}function Hi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ii(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Hi(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Hi(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Qi(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Yi(e){return"nullValue"in e?Pi:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?ji(vi.empty(),Kr.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Ir()}function Xi(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?ji(vi.empty(),Kr.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Oi:Ir()}function Ji(e,t){const n=Ui(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Zi(e,t){const n=Ui(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class es{constructor(e,t){this.position=e,this.inclusive=t}}function ts(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Kr.comparator(Kr.fromName(o.referenceValue),n.key):Ui(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ns(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Mi(e.position[n],t.position[n]))return!1;return!0}class rs{}class is extends rs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ps(e,t,n):"array-contains"===t?new vs(e,n):"in"===t?new ws(e,n):"not-in"===t?new Is(e,n):"array-contains-any"===t?new bs(e,n):new is(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ms(e,n):new gs(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ui(t,this.value)):null!==t&&Li(this.value)===Li(t)&&this.matchesComparison(Ui(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ir()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ss extends rs{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ss(e,t)}matches(e){return os(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt((e=>e.isInequality()));return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function os(e){return"and"===e.op}function as(e){return"or"===e.op}function cs(e){return us(e)&&os(e)}function us(e){for(const t of e.filters)if(t instanceof ss)return!1;return!0}function ls(e){if(e instanceof is)return e.field.canonicalString()+e.op.toString()+qi(e.value);if(cs(e))return e.filters.map((e=>ls(e))).join(",");{const t=e.filters.map((e=>ls(e))).join(",");return`${e.op}(${t})`}}function hs(e,t){return e instanceof is?function(e,t){return t instanceof is&&e.op===t.op&&e.field.isEqual(t.field)&&Mi(e.value,t.value)}(e,t):e instanceof ss?function(e,t){return t instanceof ss&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&hs(n,t.filters[r])),!0)}(e,t):void Ir()}function ds(e,t){const n=e.filters.concat(t);return ss.create(n,e.op)}function fs(e){return e instanceof is?function(e){return`${e.field.canonicalString()} ${e.op} ${qi(e.value)}`}(e):e instanceof ss?function(e){return e.op.toString()+" {"+e.getFilters().map(fs).join(" ,")+"}"}(e):"Filter"}class ps extends is{constructor(e,t,n){super(e,t,n),this.key=Kr.fromName(n.referenceValue)}matches(e){const t=Kr.comparator(e.key,this.key);return this.matchesComparison(t)}}class ms extends is{constructor(e,t){super(e,"in",t),this.keys=ys("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class gs extends is{constructor(e,t){super(e,"not-in",t),this.keys=ys("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function ys(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Kr.fromName(e.referenceValue)))}class vs extends is{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Gi(t)&&Fi(t.arrayValue,this.value)}}class ws extends is{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fi(this.value.arrayValue,t)}}class Is extends is{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Fi(this.value.arrayValue,t)}}class bs extends is{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Fi(this.value.arrayValue,e)))}}class _s{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ts(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Es{constructor(e,t){this.comparator=e,this.root=t||ks.EMPTY}insert(e,t){return new Es(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ks.BLACK,null,null))}remove(e){return new Es(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ks.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ss(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ss(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ss(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ss(this.root,e,this.comparator,!0)}}class Ss{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ks{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ks.RED,this.left=null!=r?r:ks.EMPTY,this.right=null!=i?i:ks.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ks(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ks.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ks.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ks.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ks.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ir();if(this.right.isRed())throw Ir();const e=this.left.check();if(e!==this.right.check())throw Ir();return e+(this.isRed()?0:1)}}ks.EMPTY=null,ks.RED=!0,ks.BLACK=!1,ks.EMPTY=new class{constructor(){this.size=0}get key(){throw Ir()}get value(){throw Ir()}get color(){throw Ir()}get left(){throw Ir()}get right(){throw Ir()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ks(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class As{constructor(e){this.comparator=e,this.data=new Es(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cs(this.data.getIterator())}getIteratorFrom(e){return new Cs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof As))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new As(this.comparator);return t.data=e,t}}class Cs{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ds(e){return e.hasNext()?e.getNext():void 0}class Ns{constructor(e){this.fields=e,e.sort(Gr.comparator)}static empty(){return new Ns([])}unionWith(e){let t=new As(Gr.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ns(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fr(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Rs{constructor(e){this.value=e}static empty(){return new Rs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Wi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hi(t)}setAll(e){let t=Gr.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Hi(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Wi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Wi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Ii(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Rs(Hi(this.value))}}function xs(e){const t=[];return Ii(e.fields,((e,n)=>{const r=new Gr([e]);if(Wi(n)){const e=xs(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ns(t)}class Os{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Os(e,0,qr.min(),qr.min(),qr.min(),Rs.empty(),0)}static newFoundDocument(e,t,n,r){return new Os(e,1,t,qr.min(),n,r,0)}static newNoDocument(e,t){return new Os(e,2,t,qr.min(),qr.min(),Rs.empty(),0)}static newUnknownDocument(e,t){return new Os(e,3,t,qr.min(),qr.min(),Rs.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(qr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Os&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Os(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ps{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ft=null}}function Ls(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ps(e,t,n,r,i,s,o)}function Ms(e){const t=_r(e);if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>ls(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),_i(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>qi(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>qi(e))).join(",")),t.ft=e}return t.ft}function Fs(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ts(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!hs(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ns(e.startAt,t.startAt)&&ns(e.endAt,t.endAt)}function Us(e){return Kr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Vs(e,t){return e.filters.filter((e=>e instanceof is&&e.field.isEqual(t)))}function qs(e,t,n){let r=Pi,i=!0;for(const n of Vs(e,t)){let e=Pi,t=!0;switch(n.op){case"<":case"<=":e=Yi(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Pi}Ji({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Ji({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Bs(e,t,n){let r=Oi,i=!0;for(const n of Vs(e,t)){let e=Oi,t=!0;switch(n.op){case">=":case">":e=Xi(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Oi}Zi({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Zi({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class js{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.dt=null,this._t=null,this.startAt,this.endAt}}function $s(e,t,n,r,i,s,o,a){return new js(e,t,n,r,i,s,o,a)}function Gs(e){return new js(e)}function Ks(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function zs(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Ws(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Hs(e){return null!==e.collectionGroup}function Qs(e){const t=_r(e);if(null===t.dt){t.dt=[];const e=Ws(t),n=zs(t);if(null!==e&&null===n)e.isKeyField()||t.dt.push(new _s(e)),t.dt.push(new _s(Gr.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.dt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new _s(Gr.keyField(),e))}}}return t.dt}function Ys(e){const t=_r(e);if(!t._t)if("F"===t.limitType)t._t=Ls(t.path,t.collectionGroup,Qs(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Qs(t)){const t="desc"===n.dir?"asc":"desc";e.push(new _s(n.field,t))}const n=t.endAt?new es(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new es(t.startAt.position,t.startAt.inclusive):null;t._t=Ls(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Xs(e,t){t.getFirstInequalityField(),Ws(e);const n=e.filters.concat([t]);return new js(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Js(e,t,n){return new js(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Zs(e,t){return Fs(Ys(e),Ys(t))&&e.limitType===t.limitType}function eo(e){return`${Ms(Ys(e))}|lt:${e.limitType}`}function to(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>fs(e))).join(", ")}]`),_i(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>qi(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>qi(e))).join(",")),`Target(${t})`}(Ys(e))}; limitType=${e.limitType})`}function no(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Kr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Qs(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ts(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Qs(e),t))&&!(e.endAt&&!function(e,t,n){const r=ts(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Qs(e),t))}(e,t)}function ro(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function io(e){return(t,n)=>{let r=!1;for(const i of Qs(e)){const e=so(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function so(e,t,n){const r=e.field.isKeyField()?Kr.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ui(r,i):Ir()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Ir()}}function oo(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ti(t)?"-0":t}}function ao(e){return{integerValue:""+e}}function co(e,t){return Ei(t)?ao(t):oo(e,t)}class uo{constructor(){this._=void 0}}function lo(e,t,n){return e instanceof po?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof mo?go(e,t):e instanceof yo?vo(e,t):function(e,t){const n=fo(e,t),r=Io(n)+Io(e.gt);return $i(n)&&$i(e.gt)?ao(r):oo(e.yt,r)}(e,t)}function ho(e,t,n){return e instanceof mo?go(e,t):e instanceof yo?vo(e,t):n}function fo(e,t){return e instanceof wo?$i(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class po extends uo{}class mo extends uo{constructor(e){super(),this.elements=e}}function go(e,t){const n=bo(t);for(const t of e.elements)n.some((e=>Mi(e,t)))||n.push(t);return{arrayValue:{values:n}}}class yo extends uo{constructor(e){super(),this.elements=e}}function vo(e,t){let n=bo(t);for(const t of e.elements)n=n.filter((e=>!Mi(e,t)));return{arrayValue:{values:n}}}class wo extends uo{constructor(e,t){super(),this.yt=e,this.gt=t}}function Io(e){return Ci(e.integerValue||e.doubleValue)}function bo(e){return Gi(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class _o{constructor(e,t){this.field=e,this.transform=t}}class To{constructor(e,t){this.version=e,this.transformResults=t}}class Eo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Eo}static exists(e){return new Eo(void 0,e)}static updateTime(e){return new Eo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function So(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ko{}function Ao(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Fo(e.key,Eo.none()):new xo(e.key,e.data,Eo.none());{const n=e.data,r=Rs.empty();let i=new As(Gr.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Oo(e.key,r,new Ns(i.toArray()),Eo.none())}}function Co(e,t,n){e instanceof xo?function(e,t,n){const r=e.value.clone(),i=Lo(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Oo?function(e,t,n){if(!So(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Lo(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Po(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Do(e,t,n,r){return e instanceof xo?function(e,t,n,r){if(!So(e.precondition,t))return n;const i=e.value.clone(),s=Mo(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Oo?function(e,t,n,r){if(!So(e.precondition,t))return n;const i=Mo(e.fieldTransforms,r,t),s=t.data;return s.setAll(Po(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return So(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function No(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=fo(r.transform,e||null);null!=i&&(null===n&&(n=Rs.empty()),n.set(r.field,i))}return n||null}function Ro(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Fr(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof mo&&t instanceof mo||e instanceof yo&&t instanceof yo?Fr(e.elements,t.elements,Mi):e instanceof wo&&t instanceof wo?Mi(e.gt,t.gt):e instanceof po&&t instanceof po}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class xo extends ko{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Oo extends ko{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Po(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Lo(e,t,n){const r=new Map;br(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,ho(o,a,n[i]))}return r}function Mo(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,lo(e,s,t))}return r}class Fo extends ko{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Uo extends ko{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Vo{constructor(e){this.count=e}}var qo,Bo;function jo(e){switch(e){default:return Ir();case Tr.CANCELLED:case Tr.UNKNOWN:case Tr.DEADLINE_EXCEEDED:case Tr.RESOURCE_EXHAUSTED:case Tr.INTERNAL:case Tr.UNAVAILABLE:case Tr.UNAUTHENTICATED:return!1;case Tr.INVALID_ARGUMENT:case Tr.NOT_FOUND:case Tr.ALREADY_EXISTS:case Tr.PERMISSION_DENIED:case Tr.FAILED_PRECONDITION:case Tr.ABORTED:case Tr.OUT_OF_RANGE:case Tr.UNIMPLEMENTED:case Tr.DATA_LOSS:return!0}}function $o(e){if(void 0===e)return yr("GRPC error has no .code"),Tr.UNKNOWN;switch(e){case qo.OK:return Tr.OK;case qo.CANCELLED:return Tr.CANCELLED;case qo.UNKNOWN:return Tr.UNKNOWN;case qo.DEADLINE_EXCEEDED:return Tr.DEADLINE_EXCEEDED;case qo.RESOURCE_EXHAUSTED:return Tr.RESOURCE_EXHAUSTED;case qo.INTERNAL:return Tr.INTERNAL;case qo.UNAVAILABLE:return Tr.UNAVAILABLE;case qo.UNAUTHENTICATED:return Tr.UNAUTHENTICATED;case qo.INVALID_ARGUMENT:return Tr.INVALID_ARGUMENT;case qo.NOT_FOUND:return Tr.NOT_FOUND;case qo.ALREADY_EXISTS:return Tr.ALREADY_EXISTS;case qo.PERMISSION_DENIED:return Tr.PERMISSION_DENIED;case qo.FAILED_PRECONDITION:return Tr.FAILED_PRECONDITION;case qo.ABORTED:return Tr.ABORTED;case qo.OUT_OF_RANGE:return Tr.OUT_OF_RANGE;case qo.UNIMPLEMENTED:return Tr.UNIMPLEMENTED;case qo.DATA_LOSS:return Tr.DATA_LOSS;default:return Ir()}}(Bo=qo||(qo={}))[Bo.OK=0]="OK",Bo[Bo.CANCELLED=1]="CANCELLED",Bo[Bo.UNKNOWN=2]="UNKNOWN",Bo[Bo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bo[Bo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bo[Bo.NOT_FOUND=5]="NOT_FOUND",Bo[Bo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bo[Bo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bo[Bo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bo[Bo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bo[Bo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bo[Bo.ABORTED=10]="ABORTED",Bo[Bo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bo[Bo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bo[Bo.INTERNAL=13]="INTERNAL",Bo[Bo.UNAVAILABLE=14]="UNAVAILABLE",Bo[Bo.DATA_LOSS=15]="DATA_LOSS";class Go{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ii(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return bi(this.inner)}size(){return this.innerSize}}const Ko=new Es(Kr.comparator);function zo(){return Ko}const Wo=new Es(Kr.comparator);function Ho(...e){let t=Wo;for(const n of e)t=t.insert(n.key,n);return t}function Qo(e){let t=Wo;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Yo(){return Jo()}function Xo(){return Jo()}function Jo(){return new Go((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Zo=new Es(Kr.comparator),ea=new As(Kr.comparator);function ta(...e){let t=ea;for(const n of e)t=t.add(n);return t}const na=new As(Mr);function ra(){return na}class ia{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,sa.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ia(qr.min(),r,ra(),zo(),ta())}}class sa{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new sa(n,t,ta(),ta(),ta())}}class oa{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class aa{constructor(e,t){this.targetId=e,this.Et=t}}class ca{constructor(e,t,n=Si.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ua{constructor(){this.At=0,this.Rt=da(),this.bt=Si.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=ta(),t=ta(),n=ta();return this.Rt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ir()}})),new sa(this.bt,this.Pt,e,t,n)}xt(){this.vt=!1,this.Rt=da()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class la{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=zo(),this.qt=ha(),this.Ut=new As(Mr)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,(t=>{const n=this.Wt(t);switch(e.state){case 0:this.zt(t)&&n.Dt(e.resumeToken);break;case 1:n.Mt(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.Mt(),n.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(n.Ft(),n.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:Ir()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach(((e,n)=>{this.zt(n)&&t(n)}))}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(Us(e))if(0===n){const n=new Kr(e.path);this.Qt(t,n,Os.newNoDocument(n,qr.min()))}else br(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach(((n,r)=>{const i=this.Yt(r);if(i){if(n.current&&Us(i.target)){const t=new Kr(i.target.path);null!==this.Lt.get(t)||this.te(r,t)||this.Qt(r,t,Os.newNoDocument(t,e))}n.St&&(t.set(r,n.Ct()),n.xt())}}));let n=ta();this.qt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Yt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Lt.forEach(((t,n)=>n.setReadTime(e)));const r=new ia(e,t,this.Ut,this.Lt,n);return this.Lt=zo(),this.qt=ha(),this.Ut=new As(Mr),r}Gt(e,t){if(!this.zt(e))return;const n=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new ua,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new As(Mr),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||gr("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new ua),this.$t.getRemoteKeysForTarget(e).forEach((t=>{this.Qt(e,t,null)}))}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function ha(){return new Es(Kr.comparator)}function da(){return new Es(Kr.comparator)}const fa={asc:"ASCENDING",desc:"DESCENDING"},pa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ma={and:"AND",or:"OR"};class ga{constructor(e,t){this.databaseId=e,this.wt=t}}function ya(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function va(e,t){return e.wt?t.toBase64():t.toUint8Array()}function wa(e,t){return ya(e,t.toTimestamp())}function Ia(e){return br(!!e),qr.fromTimestamp(function(e){const t=Ai(e);return new Vr(t.seconds,t.nanos)}(e))}function ba(e,t){return function(e){return new jr(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function _a(e){const t=jr.fromString(e);return br(Ga(t)),t}function Ta(e,t){return ba(e.databaseId,t.path)}function Ea(e,t){const n=_a(t);if(n.get(1)!==e.databaseId.projectId)throw new Er(Tr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Er(Tr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Kr(Ca(n))}function Sa(e,t){return ba(e.databaseId,t)}function ka(e){const t=_a(e);return 4===t.length?jr.emptyPath():Ca(t)}function Aa(e){return new jr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ca(e){return br(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Da(e,t,n){return{name:Ta(e,t),fields:n.value.mapValue.fields}}function Na(e,t,n){const r=Ea(e,t.name),i=Ia(t.updateTime),s=t.createTime?Ia(t.createTime):qr.min(),o=new Rs({mapValue:{fields:t.fields}}),a=Os.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Ra(e,t){let n;if(t instanceof xo)n={update:Da(e,t.key,t.value)};else if(t instanceof Fo)n={delete:Ta(e,t.key)};else if(t instanceof Oo)n={update:Da(e,t.key,t.data),updateMask:$a(t.fieldMask)};else{if(!(t instanceof Uo))return Ir();n={verify:Ta(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof po)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof mo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof yo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof wo)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Ir()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:wa(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ir()}(e,t.precondition)),n}function xa(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Eo.updateTime(Ia(e.updateTime)):void 0!==e.exists?Eo.exists(e.exists):Eo.none()}(t.currentDocument):Eo.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)br("REQUEST_TIME"===t.setToServerValue),n=new po;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new mo(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new yo(e)}else"increment"in t?n=new wo(e,t.increment):Ir();const r=Gr.fromServerFormat(t.fieldPath);return new _o(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Ea(e,t.update.name),s=new Rs({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Ns(t.map((e=>Gr.fromServerFormat(e))))}(t.updateMask);return new Oo(i,s,e,n,r)}return new xo(i,s,n,r)}if(t.delete){const r=Ea(e,t.delete);return new Fo(r,n)}if(t.verify){const r=Ea(e,t.verify);return new Uo(r,n)}return Ir()}function Oa(e,t){return{documents:[Sa(e,t.path)]}}function Pa(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Sa(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Sa(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return ja(ss.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:qa(e.field),direction:Fa(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.wt||_i(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function La(e){let t=ka(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){br(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Ma(e);return t instanceof ss&&cs(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new _s(Ba(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,_i(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new es(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new es(n,t)}(n.endAt)),$s(t,i,o,s,a,"F",c,u)}function Ma(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ba(e.unaryFilter.field);return is.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ba(e.unaryFilter.field);return is.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ba(e.unaryFilter.field);return is.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ba(e.unaryFilter.field);return is.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ir()}}(e):void 0!==e.fieldFilter?function(e){return is.create(Ba(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ir()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ss.create(e.compositeFilter.filters.map((e=>Ma(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ir()}}(e.compositeFilter.op))}(e):Ir()}function Fa(e){return fa[e]}function Ua(e){return pa[e]}function Va(e){return ma[e]}function qa(e){return{fieldPath:e.canonicalString()}}function Ba(e){return Gr.fromServerFormat(e.fieldPath)}function ja(e){return e instanceof is?function(e){if("=="===e.op){if(zi(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NAN"}};if(Ki(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(zi(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NOT_NAN"}};if(Ki(e.value))return{unaryFilter:{field:qa(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qa(e.field),op:Ua(e.op),value:e.value}}}(e):e instanceof ss?function(e){const t=e.getFilters().map((e=>ja(e)));return 1===t.length?t[0]:{compositeFilter:{op:Va(e.op),filters:t}}}(e):Ir()}function $a(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ga(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ka(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Wa(t)),t=za(e.get(n),t);return Wa(t)}function za(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Wa(e){return e+""}function Ha(e){const t=e.length;if(br(t>=2),2===t)return br(""===e.charAt(0)&&""===e.charAt(1)),jr.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Ir(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Ir()}s=t+2}return new jr(r)}const Qa=["userId","batchId"];function Ya(e,t){return[e,Ka(t)]}function Xa(e,t,n){return[e,Ka(t),n]}const Ja={},Za=["prefixPath","collectionGroup","readTime","documentId"],ec=["prefixPath","collectionGroup","documentId"],tc=["collectionGroup","readTime","prefixPath","documentId"],nc=["canonicalId","targetId"],rc=["targetId","path"],ic=["path","targetId"],sc=["collectionId","parent"],oc=["indexId","uid"],ac=["uid","sequenceNumber"],cc=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],uc=["indexId","uid","orderedDocumentKey"],lc=["userId","collectionPath","documentId"],hc=["userId","collectionPath","largestBatchId"],dc=["userId","collectionGroup","largestBatchId"],fc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],pc=[...fc,"documentOverlays"],mc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],gc=mc,yc=[...gc,"indexConfiguration","indexState","indexEntries"];class vc extends ni{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function wc(e,t){const n=_r(e);return oi.M(n.se,t)}class Ic{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Co(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Do(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Do(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Xo();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Ao(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(qr.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ta())}isEqual(e){return this.batchId===e.batchId&&Fr(this.mutations,e.mutations,((e,t)=>Ro(e,t)))&&Fr(this.baseMutations,e.baseMutations,((e,t)=>Ro(e,t)))}}class bc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){br(e.mutations.length===n.length);let r=Zo;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new bc(e,t,n,r)}}class _c{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Tc{constructor(e,t,n,r,i=qr.min(),s=qr.min(),o=Si.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Tc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Tc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Tc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ec{constructor(e){this.ie=e}}function Sc(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:kc(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Ta(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ya(e,t.version.toTimestamp()),createTime:ya(e,t.createTime.toTimestamp())}}(e.ie,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ac(t.version)};else{if(!t.isUnknownDocument())return Ir();r.unknownDocument={path:n.path.toArray(),version:Ac(t.version)}}return r}function kc(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ac(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Cc(e){const t=new Vr(e.seconds,e.nanoseconds);return qr.fromTimestamp(t)}function Dc(e,t){const n=(t.baseMutations||[]).map((t=>xa(e.ie,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>xa(e.ie,t))),i=Vr.fromMillis(t.localWriteTimeMs);return new Ic(t.batchId,i,n,r)}function Nc(e){const t=Cc(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Cc(e.lastLimboFreeSnapshotVersion):qr.min();let r;var i;return void 0!==e.query.documents?(br(1===(i=e.query).documents.length),r=Ys(Gs(ka(i.documents[0])))):r=function(e){return Ys(La(e))}(e.query),new Tc(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Si.fromBase64String(e.resumeToken))}function Rc(e,t){const n=Ac(t.snapshotVersion),r=Ac(t.lastLimboFreeSnapshotVersion);let i;i=Us(t.target)?Oa(e.ie,t.target):Pa(e.ie,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ms(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function xc(e){const t=La({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Js(t,t.limit,"L"):t}function Oc(e,t){return new _c(t.largestBatchId,xa(e.ie,t.overlayMutation))}function Pc(e,t){const n=t.path.lastSegment();return[e,Ka(t.path.popLast()),n]}function Lc(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ac(r.readTime),documentKey:Ka(r.documentKey.path),largestBatchId:r.largestBatchId}}class Mc{getBundleMetadata(e,t){return Fc(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Cc(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Fc(e).put({bundleId:(n=t).id,createTime:Ac(Ia(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Uc(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:xc(t.bundledQuery),readTime:Cc(t.readTime)};var t}))}saveNamedQuery(e,t){return Uc(e).put(function(e){return{name:e.name,readTime:Ac(Ia(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Fc(e){return wc(e,"bundles")}function Uc(e){return wc(e,"namedQueries")}class Vc{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){const n=t.uid||"";return new Vc(e,n)}getOverlay(e,t){return qc(e).get(Pc(this.userId,t)).next((e=>e?Oc(this.yt,e):null))}getOverlays(e,t){const n=Yo();return ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new _c(t,i);r.push(this.oe(e,s))})),ii.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Ka(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(qc(e).Y("collectionPathOverlayIndex",r))})),ii.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Yo(),i=Ka(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return qc(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Oc(this.yt,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Yo();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return qc(e).Z({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Oc(this.yt,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}oe(e,t){return qc(e).put(function(e,t,n){const[r,i,s]=Pc(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Ra(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function qc(e){return wc(e,"documentOverlays")}class Bc{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Ci(e.integerValue));else if("doubleValue"in e){const n=Ci(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),Ti(n)?t.le(0):t.le(n))}else if("timestampValue"in e){const n=e.timestampValue;this.he(t,20),"string"==typeof n?t.fe(n):(t.fe(`${n.seconds||""}`),t.le(n.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Di(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.he(t,45),t.le(n.latitude||0),t.le(n.longitude||0)}else"mapValue"in e?Qi(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):Ir()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){const n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),Kr.fromName(e).path.forEach((e=>{this.he(t,60),this.pe(e,t)}))}he(e,t){e.le(t)}_e(e){e.le(2)}}function jc(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function $c(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=jc(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Bc.Ie=new Bc;class Gc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{const e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{const e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(e){const t=this.De(e),n=$c(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}xe(e){const t=this.De(e),n=$c(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Kc{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class zc{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Wc{constructor(){this.$e=new Gc,this.Be=new Kc(this.$e),this.Le=new zc(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Hc{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Hc(this.indexId,this.documentKey,this.arrayValue,n)}}function Qc(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Yc(e.arrayValue,t.arrayValue),0!==n?n:(n=Yc(e.directionalValue,t.directionalValue),0!==n?n:Kr.comparator(e.documentKey,t.documentKey)))}function Yc(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Xc{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const e=t;e.isInequality()?this.Qe=e:this.Ge.push(e)}}je(e){br(e.collectionGroup===this.collectionId);const t=Wr(e);if(void 0!==t&&!this.We(t))return!1;const n=Hr(e);let r=0,i=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){const e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ke.length||!this.He(this.Ke[i++],e))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Jc(e){var t,n;if(br(e instanceof is||e instanceof ss),e instanceof is){if(e instanceof ws){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>is.create(e.field,"==",t))))||[];return ss.create(r,"or")}return e}const r=e.filters.map((e=>Jc(e)));return ss.create(r,e.op)}function Zc(e){if(0===e.getFilters().length)return[];const t=ru(Jc(e));return br(nu(t)),eu(t)||tu(t)?[t]:t.getFilters()}function eu(e){return e instanceof is}function tu(e){return e instanceof ss&&cs(e)}function nu(e){return eu(e)||tu(e)||function(e){if(e instanceof ss&&as(e)){for(const t of e.getFilters())if(!eu(t)&&!tu(t))return!1;return!0}return!1}(e)}function ru(e){if(br(e instanceof is||e instanceof ss),e instanceof is)return e;if(1===e.filters.length)return ru(e.filters[0]);const t=e.filters.map((e=>ru(e)));let n=ss.create(t,e.op);return n=ou(n),nu(n)?n:(br(n instanceof ss),br(os(n)),br(n.filters.length>1),n.filters.reduce(((e,t)=>iu(e,t))))}function iu(e,t){let n;return br(e instanceof is||e instanceof ss),br(t instanceof is||t instanceof ss),n=e instanceof is?t instanceof is?function(e,t){return ss.create([e,t],"and")}(e,t):su(e,t):t instanceof is?su(t,e):function(e,t){if(br(e.filters.length>0&&t.filters.length>0),os(e)&&os(t))return ds(e,t.getFilters());const n=as(e)?e:t,r=as(e)?t:e,i=n.filters.map((e=>iu(e,r)));return ss.create(i,"or")}(e,t),ou(n)}function su(e,t){if(os(t))return ds(t,e.getFilters());{const n=t.filters.map((t=>iu(e,t)));return ss.create(n,"or")}}function ou(e){if(br(e instanceof is||e instanceof ss),e instanceof is)return e;const t=e.getFilters();if(1===t.length)return ou(t[0]);if(us(e))return e;const n=t.map((e=>ou(e))),r=[];return n.forEach((t=>{t instanceof is?r.push(t):t instanceof ss&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:ss.create(r,e.op)}class au{constructor(){this.Je=new cu}addToCollectionParentIndex(e,t){return this.Je.add(t),ii.resolve()}getCollectionParents(e,t){return ii.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return ii.resolve()}deleteFieldIndex(e,t){return ii.resolve()}getDocumentsMatchingTarget(e,t){return ii.resolve(null)}getIndexType(e,t){return ii.resolve(0)}getFieldIndexes(e,t){return ii.resolve([])}getNextCollectionGroupToUpdate(e){return ii.resolve(null)}getMinOffset(e,t){return ii.resolve(Zr.min())}getMinOffsetFromCollectionGroup(e,t){return ii.resolve(Zr.min())}updateCollectionGroup(e,t,n){return ii.resolve()}updateIndexEntries(e,t){return ii.resolve()}}class cu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new As(jr.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new As(jr.comparator)).toArray()}}const uu=new Uint8Array(0);class lu{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new cu,this.Xe=new Go((e=>Ms(e)),((e,t)=>Fs(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ye.add(t)}));const i={collectionId:n,parent:Ka(r)};return hu(e).put(i)}return ii.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Ur(t),""],!1,!0);return hu(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ha(r.parent))}return n}))}addFieldIndex(e,t){const n=fu(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=pu(e);return i.next((e=>{n.put(Lc(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=fu(e),r=pu(e),i=du(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=du(e);let r=!0;const i=new Map;return ii.forEach(this.Ze(t),(t=>this.tn(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=ta();const r=[];return ii.forEach(i,((i,s)=>{var o;gr("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Ms(t)}`);const a=function(e,t){const n=Wr(t);if(void 0===n)return null;for(const t of Vs(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of Hr(t))for(const t of Vs(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of Hr(t)){const t=0===i.kind?qs(e,i.fieldPath,e.startAt):Bs(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new es(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of Hr(t)){const t=0===i.kind?Bs(e,i.fieldPath,e.endAt):qs(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new es(n,r)}(s,i),h=this.en(i,s,u),d=this.en(i,s,l),f=this.nn(i,s,c),p=this.sn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return ii.forEach(p,(i=>n.J(i,t.limit).next((t=>{t.forEach((t=>{const n=Kr.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return ii.resolve(null)}))}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:Zc(ss.create(e.filters,"and")).map((t=>Ls(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.Xe.set(e,t),t)}sn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.rn(t[l/c]):uu,h=this.on(e,a,n[l%c],r),d=this.un(e,a,i[l%c],s),f=o.map((t=>this.on(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}on(e,t,n,r){const i=new Hc(e,Kr.empty(),t,n);return r?i:i.Ue()}un(e,t,n,r){const i=new Hc(e,Kr.empty(),t,n);return r?i.Ue():i}tn(e,t){const n=new Xc(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.je(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.Ze(t);return ii.forEach(r,(t=>this.tn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new As(Gr.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}cn(e,t){const n=new Wc;for(const r of Hr(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.qe(r.kind);Bc.Ie.ue(e,i)}return n.Fe()}rn(e){const t=new Wc;return Bc.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const n=new Wc;return Bc.Ie.ue(ji(this.databaseId,t),n.qe(function(e){const t=Hr(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Fe()}nn(e,t,n){if(null===n)return[];let r=[];r.push(new Wc);let i=0;for(const s of Hr(e)){const e=n[i++];for(const n of r)if(this.hn(t,s.fieldPath)&&Gi(e))r=this.ln(r,s,e);else{const t=n.qe(s.kind);Bc.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Fe();return t}ln(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Wc;r.seed(n.Fe()),Bc.Ie.ue(e,r.qe(t.kind)),i.push(r)}return i}hn(e,t){return!!e.filters.find((e=>e instanceof is&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=fu(e),r=pu(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return ii.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Yr(t.sequenceNumber,new Zr(Cc(t.readTime),new Kr(Ha(t.documentKey)),t.largestBatchId)):Yr.empty(),r=e.fields.map((([e,t])=>new Qr(Gr.fromServerFormat(e),t)));return new zr(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Mr(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=fu(e),i=pu(e);return this.dn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>ii.forEach(t,(t=>i.put(Lc(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ii.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?ii.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ii.forEach(i,(n=>this._n(e,t,n).next((t=>{const i=this.wn(r,n);return t.isEqual(i)?ii.resolve():this.mn(e,r,n,t,i)})))))))}))}gn(e,t,n,r){return du(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return du(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,t,n){const r=du(e);let i=new As(Qc);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.an(n,t)])},((e,r)=>{i=i.add(new Hc(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}wn(e,t){let n=new As(Qc);const r=this.cn(t,e);if(null==r)return n;const i=Wr(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Gi(s))for(const i of s.arrayValue.values||[])n=n.add(new Hc(t.indexId,e.key,this.rn(i),r))}else n=n.add(new Hc(t.indexId,e.key,uu,r));return n}mn(e,t,n,r,i){gr("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Ds(s),c=Ds(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Ds(o)):t?(i(a),a=Ds(s)):(a=Ds(s),c=Ds(o))}}(r,i,Qc,(r=>{s.push(this.gn(e,t,n,r))}),(r=>{s.push(this.yn(e,t,n,r))})),ii.waitFor(s)}dn(e){let t=1;return pu(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Qc(e,t))).filter(((e,t,n)=>!t||0!==Qc(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Qc(i,e),s=Qc(i,t);if(0===n)r[0]=e.Ue();else if(n>0&&s<0)r.push(i),r.push(i.Ue());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.pn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,uu,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,uu,[]];i.push(IDBKeyRange.bound(t,n))}return i}pn(e,t){return Qc(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(mu)}getMinOffset(e,t){return ii.mapArray(this.Ze(t),(t=>this.tn(e,t).next((e=>e||Ir())))).next(mu)}}function hu(e){return wc(e,"collectionParents")}function du(e){return wc(e,"indexEntries")}function fu(e){return wc(e,"indexConfiguration")}function pu(e){return wc(e,"indexState")}function mu(e){br(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;ei(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Zr(t.readTime,t.documentKey,n)}const gu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new yu(e,yu.DEFAULT_COLLECTION_PERCENTILE,yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function vu(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Z({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{br(1===a)})));const u=[];for(const e of n.mutations){const r=Xa(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ii.waitFor(s).next((()=>u))}function wu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Ir();t=e.noDocument}return JSON.stringify(t).length}yu.DEFAULT_COLLECTION_PERCENTILE=10,yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yu.DEFAULT=new yu(41943040,yu.DEFAULT_COLLECTION_PERCENTILE,yu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yu.DISABLED=new yu(-1,0,0);class Iu{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){br(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Iu(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _u(e).Z({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Tu(e),s=_u(e);return s.add({}).next((o=>{br("number"==typeof o);const a=new Ic(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Ra(e.ie,t))),i=n.mutations.map((t=>Ra(e.ie,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.yt,this.userId,a),u=[];let l=new As(((e,t)=>Mr(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Xa(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Ja))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.In[o]=a.keys()})),ii.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return _u(e).get(t).next((e=>e?(br(e.userId===this.userId),Dc(this.yt,e)):null))}Tn(e,t){return this.In[t]?ii.resolve(this.In[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.In[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return _u(e).Z({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(br(t.batchId>=n),i=Dc(this.yt,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return _u(e).Z({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _u(e).W("userMutationsIndex",t).next((e=>e.map((e=>Dc(this.yt,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ya(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Tu(e).Z({range:r},((n,r,s)=>{const[o,a,c]=n,u=Ha(a);if(o===this.userId&&t.path.isEqual(u))return _u(e).get(c).next((e=>{if(!e)throw Ir();br(e.userId===this.userId),i.push(Dc(this.yt,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new As(Mr);const r=[];return t.forEach((t=>{const i=Ya(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Tu(e).Z({range:s},((e,r,i)=>{const[s,o,a]=e,c=Ha(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),ii.waitFor(r).next((()=>this.En(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ya(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new As(Mr);return Tu(e).Z({range:s},((e,t,i)=>{const[s,a,c]=e,u=Ha(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.En(e,o)))}En(e,t){const n=[],r=[];return t.forEach((t=>{r.push(_u(e).get(t).next((e=>{if(null===e)throw Ir();br(e.userId===this.userId),n.push(Dc(this.yt,e))})))})),ii.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return vu(e.se,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.An(t.batchId)})),ii.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ii.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Tu(e).Z({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Ha(e[1]);r.push(t)}else n.done()})).next((()=>{br(0===r.length)}))}))}containsKey(e,t){return bu(e,this.userId,t)}Rn(e){return Eu(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function bu(e,t,n){const r=Ya(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Tu(e).Z({range:s,X:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function _u(e){return wc(e,"mutations")}function Tu(e){return wc(e,"documentMutations")}function Eu(e){return wc(e,"mutationQueues")}class Su{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Su(0)}static vn(){return new Su(-1)}}class ku{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next((t=>{const n=new Su(t.highestTargetId);return t.highestTargetId=n.next(),this.Sn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Vn(e).next((e=>qr.fromTimestamp(new Vr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Vn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Vn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r))))}addTargetData(e,t){return this.Dn(e,t).next((()=>this.Vn(e).next((n=>(n.targetCount+=1,this.Cn(t,n),this.Sn(e,n))))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Au(e).delete(t.targetId))).next((()=>this.Vn(e))).next((t=>(br(t.targetCount>0),t.targetCount-=1,this.Sn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Au(e).Z(((s,o)=>{const a=Nc(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>ii.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Au(e).Z(((e,n)=>{const r=Nc(n);t(r)}))}Vn(e){return Cu(e).get("targetGlobalKey").next((e=>(br(null!==e),e)))}Sn(e,t){return Cu(e).put("targetGlobalKey",t)}Dn(e,t){return Au(e).put(Rc(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Ms(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Au(e).Z({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Nc(n);Fs(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Du(e);return t.forEach((t=>{const s=Ka(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),ii.waitFor(r)}removeMatchingKeys(e,t,n){const r=Du(e);return ii.forEach(t,(t=>{const i=Ka(t.path);return ii.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Du(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Du(e);let i=ta();return r.Z({range:n,X:!0},((e,t,n)=>{const r=Ha(e[1]),s=new Kr(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Ka(t.path),r=IDBKeyRange.bound([n],[Ur(n)],!1,!0);let i=0;return Du(e).Z({index:"documentTargetsIndex",X:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}ne(e,t){return Au(e).get(t).next((e=>e?Nc(e):null))}}function Au(e){return wc(e,"targets")}function Cu(e){return wc(e,"targetGlobal")}function Du(e){return wc(e,"targetDocuments")}function Nu([e,t],[n,r]){const i=Mr(e,n);return 0===i?Mr(t,r):i}class Ru{constructor(e){this.xn=e,this.buffer=new As(Nu),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Nu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class xu{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){gr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ui(e)?gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ri(e)}await this.Fn(3e5)}))}}class Ou{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ii.resolve(gi.at);const n=new Ru(t);return this.$n.forEachTarget(e,(e=>n.On(e.sequenceNumber))).next((()=>this.$n.Ln(e,(e=>n.On(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector","Garbage collection skipped; disabled"),ii.resolve(gu)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),gu):this.qn(e,t)))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let n,r,i,s,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(gr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),mr()<=a.in.DEBUG&&gr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),ii.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class Pu{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Ou(e,t)}(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Un(e){let t=0;return this.Ln(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,((e,n)=>t(n)))}addReference(e,t,n){return Lu(e,n)}removeReference(e,t,n){return Lu(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Lu(e,t)}Gn(e,t){return function(e,t){let n=!1;return Eu(e).tt((r=>bu(e,r,t).next((e=>(e&&(n=!0),ii.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Kn(e,((s,o)=>{if(o<=t){const t=this.Gn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,qr.min()),Du(e).delete([0,Ka(s.path)]))))}));r.push(t)}})).next((()=>ii.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Lu(e,t)}Kn(e,t){const n=Du(e);let r,i=gi.at;return n.Z({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==gi.at&&t(new Kr(Ha(r)),i),i=o,r=s):i=gi.at})).next((()=>{i!==gi.at&&t(new Kr(Ha(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Lu(e,t){return Du(e).put(function(e,t){return{targetId:0,path:Ka(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Mu{constructor(){this.changes=new Go((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Os.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ii.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Fu{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Bu(e).put(n)}removeEntry(e,t,n){return Bu(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],kc(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Qn(e,n))))}getEntry(e,t){let n=Os.newInvalidDocument(t);return Bu(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ju(t))},((e,r)=>{n=this.jn(t,r)})).next((()=>n))}Wn(e,t){let n={size:0,document:Os.newInvalidDocument(t)};return Bu(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ju(t))},((e,r)=>{n={document:this.jn(t,r),size:wu(r)}})).next((()=>n))}getEntries(e,t){let n=zo();return this.zn(e,t,((e,t)=>{const r=this.jn(e,t);n=n.insert(e,r)})).next((()=>n))}Hn(e,t){let n=zo(),r=new Es(Kr.comparator);return this.zn(e,t,((e,t)=>{const i=this.jn(e,t);n=n.insert(e,i),r=r.insert(e,wu(t))})).next((()=>({documents:n,Jn:r})))}zn(e,t,n){if(t.isEmpty())return ii.resolve();let r=new As(Gu);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(ju(r.first()),ju(r.last())),s=r.getIterator();let o=s.getNext();return Bu(e).Z({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=Kr.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Gu(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.j(ju(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),kc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Bu(e).W(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=zo();for(const i of e){const e=this.jn(Kr.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(no(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=zo();const s=$u(t,n),o=$u(t,Zr.max());return Bu(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.jn(Kr.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Vu(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return qu(e).get("remoteDocumentGlobalKey").next((e=>(br(!!e),e)))}Qn(e,t){return qu(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Na(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Kr.fromSegments(t.noDocument.path),r=Cc(t.noDocument.readTime);n=Os.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Ir();{const e=Kr.fromSegments(t.unknownDocument.path),r=Cc(t.unknownDocument.version);n=Os.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Vr(e[0],e[1]);return qr.fromTimestamp(t)}(t.readTime)),n}(this.yt,t);if(!e.isNoDocument()||!e.version.isEqual(qr.min()))return e}return Os.newInvalidDocument(e)}}function Uu(e){return new Fu(e)}class Vu extends Mu{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Go((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new As(((e,t)=>Mr(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Sc(this.Yn.yt,s);r=r.add(i.path.popLast());const c=wu(a);n+=c-o.size,t.push(this.Yn.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Sc(this.Yn.yt,s.convertToNoDocument(qr.min()));t.push(this.Yn.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Yn.updateMetadata(e,n)),ii.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next((e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next((({documents:e,Jn:t})=>(t.forEach(((t,n)=>{this.Xn.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function qu(e){return wc(e,"remoteDocumentGlobal")}function Bu(e){return wc(e,"remoteDocumentsV14")}function ju(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function $u(e,t){const n=t.documentKey.path.toArray();return[e,kc(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Gu(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Mr(n[e],r[e]),i)return i;return i=Mr(n.length,r.length),i||(i=Mr(n[n.length-2],r[r.length-2]),i||Mr(n[n.length-1],r[r.length-1]))}class Ku{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class zu{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Do(n.mutation,e,Ns.empty(),Vr.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ta()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ta()){const r=Yo();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Ho();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Yo();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ta())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=zo();const s=Jo(),o=Jo();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Oo)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Do(o.mutation,t,o.mutation.getFieldMask(),Vr.now())):s.set(t.key,Ns.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Ku(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Jo();let r=new Es(((e,t)=>e-t)),i=ta();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Ns.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||ta()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Xo();c.forEach((e=>{if(!i.has(e)){const r=Ao(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return ii.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return Kr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Hs(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ii.resolve(Yo());let o=-1,a=i;return s.next((t=>ii.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ii.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ta()))).next((e=>({batchId:o,changes:Qo(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Kr(t)).next((e=>{let t=Ho();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Ho();return this.indexManager.getCollectionParents(e,r).next((s=>ii.forEach(s,(s=>{const o=function(e,t){return new js(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Os.newInvalidDocument(r)))}));let n=Ho();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&Do(s.mutation,i,Ns.empty(),Vr.now()),no(t,i)&&(n=n.insert(e,i))})),n}))}}class Wu{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return ii.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:Ia(n.createTime)}),ii.resolve()}getNamedQuery(e,t){return ii.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:xc(e.bundledQuery),readTime:Ia(e.readTime)}}(t)),ii.resolve()}}class Hu{constructor(){this.overlays=new Es(Kr.comparator),this.es=new Map}getOverlay(e,t){return ii.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Yo();return ii.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.oe(e,t,r)})),ii.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.es.delete(n)),ii.resolve()}getOverlaysForCollection(e,t,n){const r=Yo(),i=t.length+1,s=new Kr(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ii.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Es(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Yo(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Yo(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ii.resolve(o)}oe(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new _c(t,n));let i=this.es.get(t);void 0===i&&(i=ta(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class Qu{constructor(){this.ns=new As(Yu.ss),this.rs=new As(Yu.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const n=new Yu(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.cs(new Yu(e,t))}hs(e,t){e.forEach((e=>this.removeReference(e,t)))}ls(e){const t=new Kr(new jr([])),n=new Yu(t,e),r=new Yu(t,e+1),i=[];return this.rs.forEachInRange([n,r],(e=>{this.cs(e),i.push(e.key)})),i}fs(){this.ns.forEach((e=>this.cs(e)))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new Kr(new jr([])),n=new Yu(t,e),r=new Yu(t,e+1);let i=ta();return this.rs.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Yu(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Yu{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return Kr.comparator(e.key,t.key)||Mr(e._s,t._s)}static os(e,t){return Mr(e._s,t._s)||Kr.comparator(e.key,t.key)}}class Xu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new As(Yu.ss)}checkEmpty(e){return ii.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ic(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.gs=this.gs.add(new Yu(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ii.resolve(s)}lookupMutationBatch(e,t){return ii.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ps(n),i=r<0?0:r;return ii.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ii.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return ii.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Yu(t,0),r=new Yu(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],(e=>{const t=this.ys(e._s);i.push(t)})),ii.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new As(Mr);return t.forEach((e=>{const t=new Yu(e,0),r=new Yu(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,r],(e=>{n=n.add(e._s)}))})),ii.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Kr.isDocumentKey(i)||(i=i.child(""));const s=new Yu(new Kr(i),0);let o=new As(Mr);return this.gs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)}),s),ii.resolve(this.Is(o))}Is(e){const t=[];return e.forEach((e=>{const n=this.ys(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){br(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return ii.forEach(t.mutations,(r=>{const i=new Yu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.gs=n}))}An(e){}containsKey(e,t){const n=new Yu(t,0),r=this.gs.firstAfterOrEqual(n);return ii.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ii.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ju{constructor(e){this.Es=e,this.docs=new Es(Kr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ii.resolve(n?n.document.mutableCopy():Os.newInvalidDocument(t))}getEntries(e,t){let n=zo();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Os.newInvalidDocument(e))})),ii.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=zo();const s=t.path,o=new Kr(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||ei(Jr(o),n)<=0||(r.has(o.key)||no(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ii.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Ir()}As(e,t){return ii.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Zu(this)}getSize(e){return ii.resolve(this.size)}}class Zu extends Mu{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)})),ii.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class el{constructor(e){this.persistence=e,this.Rs=new Go((e=>Ms(e)),Fs),this.lastRemoteSnapshotVersion=qr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Qu,this.targetCount=0,this.vs=Su.Pn()}forEachTarget(e,t){return this.Rs.forEach(((e,n)=>t(n))),ii.resolve()}getLastRemoteSnapshotVersion(e){return ii.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ii.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),ii.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),ii.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Su(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,ii.resolve()}updateTargetData(e,t){return this.Dn(t),ii.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,ii.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Rs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ii.waitFor(i).next((()=>r))}getTargetCount(e){return ii.resolve(this.targetCount)}getTargetData(e,t){const n=this.Rs.get(t)||null;return ii.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),ii.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ii.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),ii.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ps.ds(t);return ii.resolve(n)}containsKey(e,t){return ii.resolve(this.Ps.containsKey(t))}}class tl{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new gi(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new el(this),this.indexManager=new au,this.remoteDocumentCache=function(e){return new Ju(e)}((e=>this.referenceDelegate.xs(e))),this.yt=new Ec(t),this.Ns=new Wu(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Xu(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){gr("MemoryPersistence","Starting transaction:",e);const r=new nl(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((e=>this.referenceDelegate.Os(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ms(e,t){return ii.or(Object.values(this.Vs).map((n=>()=>n.containsKey(e,t))))}}class nl extends ni{constructor(e){super(),this.currentSequenceNumber=e}}class rl{constructor(e){this.persistence=e,this.Fs=new Qu,this.$s=null}static Bs(e){return new rl(e)}get Ls(){if(this.$s)return this.$s;throw Ir()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),ii.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),ii.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),ii.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach((e=>this.Ls.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ls.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ii.forEach(this.Ls,(n=>{const r=Kr.fromPath(n);return this.qs(e,r).next((e=>{e||t.removeEntry(r,qr.min())}))})).next((()=>(this.$s=null,t.apply(e))))}updateLimboDocument(e,t){return this.qs(e,t).next((e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())}))}xs(e){return 0}qs(e,t){return ii.or([()=>ii.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class il{constructor(e){this.yt=e}$(e,t,n,r){const i=new si("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qa,{unique:!0}),e.createObjectStore("documentMutations")}(e),sl(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=ii.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),sl(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qr.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qa,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return ii.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Us(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i))))),n<7&&r>=7&&(s=s.next((()=>this.Gs(i)))),n<8&&r>=8&&(s=s.next((()=>this.Qs(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.js(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:lc});t.createIndex("collectionPathOverlayIndex",hc,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",dc,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Za});t.createIndex("documentKeyIndex",ec),t.createIndex("collectionGroupIndex",tc)}(e))).next((()=>this.Ws(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.zs(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:oc}).createIndex("sequenceNumberIndex",ac,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:cc}).createIndex("documentKeyIndex",uc,{unique:!1})}(e)))),s}Ks(e){let t=0;return e.store("remoteDocuments").Z(((e,n)=>{t+=wu(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Us(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>ii.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>ii.forEach(n,(n=>{br(n.userId===t.userId);const r=Dc(this.yt,n);return vu(e,t.userId,r).next((()=>{}))}))))}))))}Gs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Z(((n,i)=>{const s=new jr(n),o=function(e){return[0,Ka(e)]}(s);r.push(t.get(o).next((n=>n?ii.resolve():(n=>t.put({targetId:0,path:Ka(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>ii.waitFor(r)))}))}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:sc});const n=t.store("collectionParents"),r=new cu,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ka(r)})}};return t.store("remoteDocuments").Z({X:!0},((e,t)=>{const n=new jr(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Z({X:!0},(([e,t,n],r)=>{const s=Ha(t);return i(s.popLast())}))))}js(e){const t=e.store("targets");return t.Z(((e,n)=>{const r=Nc(n),i=Rc(this.yt,r);return t.put(i)}))}Ws(e,t){const n=t.store("remoteDocuments"),r=[];return n.Z(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new Kr(jr.fromString(o.document.name).popFirst(5)):o.noDocument?Kr.fromSegments(o.noDocument.path):o.unknownDocument?Kr.fromSegments(o.unknownDocument.path):Ir()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>ii.waitFor(r)))}zs(e,t){const n=t.store("mutations"),r=Uu(this.yt),i=new tl(rl.Bs,this.yt.ie);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:ta();Dc(this.yt,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),ii.forEach(n,((e,n)=>{const s=new dr(n),o=Vc.re(this.yt,s),a=i.getIndexManager(s),c=Iu.re(s,this.yt,a,i.referenceDelegate);return new zu(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new vc(t,gi.at),e).next()}))}))}}function sl(e){e.createObjectStore("targetDocuments",{keyPath:rc}).createIndex("documentTargetsIndex",ic,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",nc,{unique:!0}),e.createObjectStore("targetGlobal")}const ol="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class al{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=o,this.Js=c,this.Ys=u,this.Xs=l,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!al.C())throw new Er(Tr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Pu(this,r),this.ii=t+"main",this.yt=new Ec(a),this.ri=new oi(this.ii,this.Xs,new il(this.yt)),this.Cs=new ku(this.referenceDelegate,this.yt),this.remoteDocumentCache=Uu(this.yt),this.Ns=new Mc,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===u&&yr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Er(Tr.FAILED_PRECONDITION,ol);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Cs.getHighestSequenceNumber(e)))})).then((e=>{this.Ss=new gi(e,this.Js)})).then((()=>{this.Ds=!0})).catch((e=>(this.ri&&this.ri.close(),Promise.reject(e))))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((async()=>{this.started&&await this.ui()})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>ul(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.fi(e).next((e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))))}))})).next((()=>this.di(e))).next((t=>this.isPrimary&&!t?this._i(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(ui(e))return gr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable((()=>this.si(e))),this.isPrimary=e}))}fi(e){return cl(e).get("owner").next((e=>ii.resolve(this.mi(e))))}gi(e){return ul(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=wc(e,"clientMetadata");return t.W().next((e=>{const n=this.Ii(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return ii.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ui().then((()=>this.yi())).then((()=>this.hi()))))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?ii.resolve(!0):cl(e).get("owner").next((t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new Er(Tr.FAILED_PRECONDITION,ol);return!1}}return!(!this.networkEnabled||!this.inForeground)||ul(e).W().next((e=>void 0===this.Ii(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&gr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new vc(e,gi.at);return this._i(t).next((()=>this.gi(t)))})),this.ri.close(),this.Pi()}Ii(e,t){return e.filter((e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId)))}vi(){return this.runTransaction("getActiveClients","readonly",(e=>ul(e).W().next((e=>this.Ii(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ds}getMutationQueue(e,t){return Iu.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lu(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Vc.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,n){gr("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.Xs)?yc:14===s?gc:13===s?mc:12===s?pc:11===s?fc:void Ir();var s;let o;return this.ri.runTransaction(e,r,i,(r=>(o=new vc(r,this.Ss?this.Ss.next():gi.at),"readwrite-primary"===t?this.fi(o).next((e=>!!e||this.di(o))).next((t=>{if(!t)throw yr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))),new Er(Tr.FAILED_PRECONDITION,ti);return n(o)})).next((e=>this.wi(o).next((()=>e)))):this.Vi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Vi(e){return cl(e).get("owner").next((e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Er(Tr.FAILED_PRECONDITION,ol)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cl(e).put("owner",t)}static C(){return oi.C()}_i(e){const t=cl(e);return t.get("owner").next((e=>this.mi(e)?(gr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ii.resolve()))}pi(e,t){const n=Date.now();return!(e<n-t||e>n&&(yr(`Detected an update time that is in the future: ${e} > ${n}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ui())))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,c.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return gr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return yr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){yr("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function cl(e){return wc(e,"owner")}function ul(e){return wc(e,"clientMetadata")}function ll(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class hl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=ta(),r=ta();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new hl(e,t.fromCache,n,r)}}class dl{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next((i=>i||this.Oi(e,t,r,n))).next((n=>n||this.Mi(e,t)))}ki(e,t){if(Ks(t))return ii.resolve(null);let n=Ys(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Js(t,null,"F"),n=Ys(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ta(...r);return this.Ni.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,Js(t,null,"F")):this.Bi(e,s,t,n)}))))})))))}Oi(e,t,n,r){return Ks(t)||r.isEqual(qr.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next((i=>{const s=this.Fi(t,i);return this.$i(t,s,n,r)?this.Mi(e,t):(mr()<=a.in.DEBUG&&gr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),to(t)),this.Bi(e,s,t,Xr(r,-1)))}))}Fi(e,t){let n=new As(io(e));return t.forEach(((t,r)=>{no(e,r)&&(n=n.add(r))})),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return mr()<=a.in.DEBUG&&gr("QueryEngine","Using full collection scan to execute query:",to(t)),this.Ni.getDocumentsMatchingQuery(e,t,Zr.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class fl{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new Es(Mr),this.Ui=new Go((e=>Ms(e)),Fs),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zu(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qi)))}}function pl(e,t,n,r){return new fl(e,t,n,r)}async function ml(e,t){const n=_r(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Qi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=ta();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ji:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function gl(e){const t=_r(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Cs.getLastRemoteSnapshotVersion(e)))}function yl(e,t,n){let r=ta(),i=ta();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=zo();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(qr.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):gr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Wi:r,zi:i}}))}function vl(e,t){const n=_r(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function wl(e,t){const n=_r(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Cs.getTargetData(e,t).next((i=>i?(r=i,ii.resolve(r)):n.Cs.allocateTargetId(e).next((i=>(r=new Tc(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qi.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qi=n.qi.insert(e.targetId,e),n.Ui.set(t,e.targetId)),e}))}async function Il(e,t,n){const r=_r(e),i=r.qi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ui(e))throw e;gr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qi=r.qi.remove(t),r.Ui.delete(i.target)}function bl(e,t,n){const r=_r(e);let i=qr.min(),s=ta();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=_r(e),i=r.Ui.get(n);return void 0!==i?ii.resolve(r.qi.get(i)):r.Cs.getTargetData(t,n)}(r,e,Ys(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Li.getDocumentsMatchingQuery(e,t,n?i:qr.min(),n?s:ta()))).next((e=>(El(r,ro(t),e),{documents:e,Hi:s})))))}function _l(e,t){const n=_r(e),r=_r(n.Cs),i=n.qi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.ne(e,t).next((e=>e?e.target:null))))}function Tl(e,t){const n=_r(e),r=n.Ki.get(t)||qr.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Gi.getAllFromCollectionGroup(e,t,Xr(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(El(n,t,e),e)))}function El(e,t,n){let r=e.Ki.get(t)||qr.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}async function Sl(e,t,n=ta()){const r=await wl(e,Ys(xc(t.bundledQuery))),i=_r(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Ia(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ns.saveNamedQuery(e,t);const o=r.withResumeToken(Si.EMPTY_BYTE_STRING,s);return i.qi=i.qi.insert(o.targetId,o),i.Cs.updateTargetData(e,o).next((()=>i.Cs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Cs.addMatchingKeys(e,n,r.targetId))).next((()=>i.Ns.saveNamedQuery(e,t)))}))}function kl(e,t){return`firestore_clients_${e}_${t}`}function Al(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Cl(e,t){return`firestore_targets_${e}_${t}`}class Dl{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Er(r.error.code,r.error.message))),s?new Dl(e,t,r.state,i):(yr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Nl{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Er(n.error.code,n.error.message))),i?new Nl(e,n.state,r):(yr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Rl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ra();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Ei(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new Rl(e,i):(yr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class xl{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new xl(t.clientId,t.onlineState):(yr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ol{constructor(){this.activeTargetIds=ra()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pl{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new Es(Mr),this.started=!1,this.cr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=kl(this.persistenceKey,this.sr),this.hr=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new Ol),this.lr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.wr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.mr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const t of e){if(t===this.sr)continue;const e=this.getItem(kl(this.persistenceKey,t));if(e){const n=Rl.Zi(t,e);n&&(this.ur=this.ur.insert(n.clientId,n))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const e=this.yr(t);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Cl(this.persistenceKey,e));if(n){const r=Nl.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Cl(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Er(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return gr("SharedClientState","READ",e,t),t}setItem(e,t){gr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){gr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(gr("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void yr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.lr.test(t.key)){if(null==t.newValue){const e=this.vr(t.key);return this.Vr(e,null)}{const e=this.Sr(t.key,t.newValue);if(e)return this.Vr(e.clientId,e)}}else if(this.dr.test(t.key)){if(null!==t.newValue){const e=this.Dr(t.key,t.newValue);if(e)return this.Cr(e)}}else if(this._r.test(t.key)){if(null!==t.newValue){const e=this.Nr(t.key,t.newValue);if(e)return this.kr(e)}}else if(t.key===this.wr){if(null!==t.newValue){const e=this.yr(t.newValue);if(e)return this.pr(e)}}else if(t.key===this.hr){const e=function(e){let t=gi.at;if(null!=e)try{const n=JSON.parse(e);br("number"==typeof n),t=n}catch(e){yr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==gi.at&&this.sequenceNumberHandler(e)}else if(t.key===this.mr){const e=this.Or(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Mr(e))))}}else this.cr.push(t)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new Dl(this.currentUser,e,t,n),i=Al(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){const t=Al(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){const r=Cl(this.persistenceKey,e),i=new Nl(e,t,n);this.setItem(r,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const n=this.vr(e);return Rl.Zi(n,t)}Dr(e,t){const n=this.dr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Dl.Zi(new dr(i),r,t)}Nr(e,t){const n=this._r.exec(e),r=Number(n[1]);return Nl.Zi(r,t)}yr(e){return xl.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);gr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Br(s,o).then((()=>{this.ur=n}))}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=ra();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Ll{constructor(){this.Lr=new Ol,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Ol,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ml{Ur(e){}shutdown(){}}class Fl{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ul={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Vl{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class ql extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){const s=this.ho(e,t);gr("RestConnection","Sending: ",s,n);const o={};return this.lo(o,r,i),this.fo(e,s,o,n).then((e=>(gr("RestConnection","Received: ",e),e)),(t=>{throw vr("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+fr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=Ul[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise(((i,s)=>{const o=new lr;o.setWithCredentials(!0),o.listenOnce(sr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case ir.NO_ERROR:const t=o.getResponseJson();gr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case ir.TIMEOUT:gr("Connection",'RPC "'+e+'" timed out'),s(new Er(Tr.DEADLINE_EXCEEDED,"Request time out"));break;case ir.HTTP_ERROR:const n=o.getStatus();if(gr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Tr).indexOf(t)>=0?t:Tr.UNKNOWN}(t.status);s(new Er(e,t.message))}else s(new Er(Tr.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Er(Tr.UNAVAILABLE,"Connection failed."));break;default:Ir()}}finally{gr("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=nr(),s=rr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new cr({})),this.lo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const a=r.join("");gr("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,l=!1;const h=new Vl({Hr:e=>{l?gr("Connection","Not sending because WebChannel is closed:",e):(u||(gr("Connection","Opening WebChannel transport."),c.open(),u=!0),gr("Connection","WebChannel sending:",e),c.send(e))},Jr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,ur.EventType.OPEN,(()=>{l||gr("Connection","WebChannel transport opened.")})),d(c,ur.EventType.CLOSE,(()=>{l||(l=!0,gr("Connection","WebChannel transport closed"),h.io())})),d(c,ur.EventType.ERROR,(e=>{l||(l=!0,vr("Connection","WebChannel transport errored:",e),h.io(new Er(Tr.UNAVAILABLE,"The operation could not be completed")))})),d(c,ur.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];br(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){gr("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=qo[e];if(void 0!==t)return $o(t)}(e),n=i.message;void 0===t&&(t=Tr.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,h.io(new Er(t,n)),c.close()}else gr("Connection","WebChannel received:",n),h.ro(n)}})),d(s,or.STAT_EVENT,(e=>{e.stat===ar.PROXY?gr("Connection","Detected buffering proxy"):e.stat===ar.NOPROXY&&gr("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.so()}),0),h}}function Bl(){return"undefined"!=typeof window?window:null}function jl(){return"undefined"!=typeof document?document:null}function $l(e){return new ga(e,!0)}class Gl{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&gr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Kl{constructor(e,t,n,r,i,s,o,a){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Gl(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===Tr.RESOURCE_EXHAUSTED?(yr(t.toString()),yr("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===Tr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.So===t&&this.Go(e,n)}),(t=>{e((()=>{const e=new Er(Tr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)}))}))}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((e=>{n((()=>this.Qo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(e){return gr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget((()=>this.So===e?t():(gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class zl extends Kl{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ir()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.wt?(br(void 0===t||"string"==typeof t),Si.fromBase64String(t||"")):(br(void 0===t||t instanceof Uint8Array),Si.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Tr.UNKNOWN:$o(e.code);return new Er(t,e.message||"")}(o);n=new ca(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ea(e,r.document.name),s=Ia(r.document.updateTime),o=r.document.createTime?Ia(r.document.createTime):qr.min(),a=new Rs({mapValue:{fields:r.document.fields}}),c=Os.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new oa(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ea(e,r.document),s=r.readTime?Ia(r.readTime):qr.min(),o=Os.newNoDocument(i,s),a=r.removedTargetIds||[];n=new oa([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ea(e,r.document),s=r.removedTargetIds||[];n=new oa([],s,i,null)}else{if(!("filter"in t))return Ir();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Vo(r),s=e.targetId;n=new aa(s,i)}}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return qr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?qr.min():t.readTime?Ia(t.readTime):qr.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=Aa(this.yt),t.addTarget=function(e,t){let n;const r=t.target;return n=Us(r)?{documents:Oa(e,r)}:{query:Pa(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=va(e,t.resumeToken):t.snapshotVersion.compareTo(qr.min())>0&&(n.readTime=ya(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ir()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}Ho(e){const t={};t.database=Aa(this.yt),t.removeTarget=e,this.Bo(t)}}class Wl extends Kl{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(br(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function(e,t){return e&&e.length>0?(br(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Ia(e.updateTime):Ia(t);return n.isEqual(qr.min())&&(n=Ia(t)),new To(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Ia(e.commitTime);return this.listener.Zo(n,t)}return br(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=Aa(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ra(this.yt,e)))};this.Bo(t)}}class Hl extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new Er(Tr.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.ao(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Tr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Er(Tr.UNKNOWN,e.toString())}))}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection._o(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Tr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Er(Tr.UNKNOWN,e.toString())}))}terminate(){this.nu=!0}}class Ql{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(yr(t),this.ou=!1):gr("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Yl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur((e=>{n.enqueueAndForget((async()=>{sh(this)&&(gr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=_r(e);t._u.add(4),await Jl(t),t.gu.set("Unknown"),t._u.delete(4),await Xl(t)}(this))}))})),this.gu=new Ql(n,r)}}async function Xl(e){if(sh(e))for(const t of e.wu)await t(!0)}async function Jl(e){for(const t of e.wu)await t(!1)}function Zl(e,t){const n=_r(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),ih(n)?rh(n):Th(n).ko()&&th(n,t))}function eh(e,t){const n=_r(e),r=Th(n);n.du.delete(t),r.ko()&&nh(n,t),0===n.du.size&&(r.ko()?r.Fo():sh(n)&&n.gu.set("Unknown"))}function th(e,t){e.yu.Ot(t.targetId),Th(e).zo(t)}function nh(e,t){e.yu.Ot(t),Th(e).Ho(t)}function rh(e){e.yu=new la({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.du.get(t)||null}),Th(e).start(),e.gu.uu()}function ih(e){return sh(e)&&!Th(e).No()&&e.du.size>0}function sh(e){return 0===_r(e)._u.size}function oh(e){e.yu=void 0}async function ah(e){e.du.forEach(((t,n)=>{th(e,t)}))}async function ch(e,t){oh(e),ih(e)?(e.gu.hu(t),rh(e)):e.gu.set("Unknown")}async function uh(e,t,n){if(e.gu.set("Online"),t instanceof ca&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){gr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await lh(e,n)}else if(t instanceof oa?e.yu.Kt(t):t instanceof aa?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(qr.min()))try{const t=await gl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.yu.Zt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(Si.EMPTY_BYTE_STRING,n.snapshotVersion)),nh(e,t);const r=new Tc(n.target,t,1,n.sequenceNumber);th(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){gr("RemoteStore","Failed to raise snapshot:",t),await lh(e,t)}}async function lh(e,t,n){if(!ui(t))throw t;e._u.add(1),await Jl(e),e.gu.set("Offline"),n||(n=()=>gl(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{gr("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await Xl(e)}))}function hh(e,t){return t().catch((n=>lh(e,n,t)))}async function dh(e){const t=_r(e),n=Eh(t);let r=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;fh(t);)try{const e=await vl(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,ph(t,e)}catch(e){await lh(t,e)}mh(t)&&gh(t)}function fh(e){return sh(e)&&e.fu.length<10}function ph(e,t){e.fu.push(t);const n=Eh(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function mh(e){return sh(e)&&!Eh(e).No()&&e.fu.length>0}function gh(e){Eh(e).start()}async function yh(e){Eh(e).eu()}async function vh(e){const t=Eh(e);for(const n of e.fu)t.Xo(n.mutations)}async function wh(e,t,n){const r=e.fu.shift(),i=bc.from(r,t,n);await hh(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await dh(e)}async function Ih(e,t){t&&Eh(e).Yo&&await async function(e,t){if(jo(n=t.code)&&n!==Tr.ABORTED){const n=e.fu.shift();Eh(e).Mo(),await hh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await dh(e)}var n}(e,t),mh(e)&&gh(e)}async function bh(e,t){const n=_r(e);n.asyncQueue.verifyOperationInProgress(),gr("RemoteStore","RemoteStore received new credentials");const r=sh(n);n._u.add(3),await Jl(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await Xl(n)}async function _h(e,t){const n=_r(e);t?(n._u.delete(2),await Xl(n)):t||(n._u.add(2),await Jl(n),n.gu.set("Unknown"))}function Th(e){return e.pu||(e.pu=function(e,t,n){const r=_r(e);return r.su(),new zl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:ah.bind(null,e),Zr:ch.bind(null,e),Wo:uh.bind(null,e)}),e.wu.push((async t=>{t?(e.pu.Mo(),ih(e)?rh(e):e.gu.set("Unknown")):(await e.pu.stop(),oh(e))}))),e.pu}function Eh(e){return e.Iu||(e.Iu=function(e,t,n){const r=_r(e);return r.su(),new Wl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:yh.bind(null,e),Zr:Ih.bind(null,e),tu:vh.bind(null,e),Zo:wh.bind(null,e)}),e.wu.push((async t=>{t?(e.Iu.Mo(),await dh(e)):(await e.Iu.stop(),e.fu.length>0&&(gr("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))}))),e.Iu}class Sh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Sr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sh(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Er(Tr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function kh(e,t){if(yr("AsyncQueue",`${t}: ${e}`),ui(e))return new Er(Tr.UNAVAILABLE,`${t}: ${e}`);throw e}class Ah{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Kr.comparator(t.key,n.key):(e,t)=>Kr.comparator(e.key,t.key),this.keyedMap=Ho(),this.sortedSet=new Es(this.comparator)}static emptySet(e){return new Ah(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ah))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ah;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ch{constructor(){this.Tu=new Es(Kr.comparator)}track(e){const t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):Ir():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Dh{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Dh(e,t,Ah.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Nh{constructor(){this.Au=void 0,this.listeners=[]}}class Rh{constructor(){this.queries=new Go((e=>eo(e)),Zs),this.onlineState="Unknown",this.Ru=new Set}}async function xh(e,t){const n=_r(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Nh),i)try{s.Au=await n.onListen(r)}catch(e){const n=kh(e,`Initialization of query '${to(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&Mh(n)}async function Oh(e,t){const n=_r(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Ph(e,t){const n=_r(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&Mh(n)}function Lh(e,t,n){const r=_r(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Mh(e){e.Ru.forEach((e=>{e.next()}))}class Fh{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Dh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=Dh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Uh{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Vh{constructor(e){this.yt=e}Ji(e){return Ea(this.yt,e)}Yi(e){return e.metadata.exists?Na(this.yt,e.document,!1):Os.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Ia(e)}}class qh{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Bh(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=jr.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new Vh(this.yt);for(const r of e)if(r.metadata.queries){const e=n.Ji(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||ta()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=_r(e);let s=ta(),o=zo();for(const e of n){const n=t.Ji(e.metadata.name);e.document&&(s=s.add(n));const r=t.Yi(e);r.setReadTime(t.Xi(e.metadata.readTime)),o=o.insert(n,r)}const a=i.Gi.newChangeBuffer({trackRemovals:!0}),c=await wl(i,function(e){return Ys(Gs(jr.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>yl(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Cs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Cs.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.Wi,t.zi))).next((()=>t.Wi))))))}(this.localStore,new Vh(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await Sl(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function Bh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class jh{constructor(e){this.key=e}}class $h{constructor(e){this.key=e}}class Gh{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=ta(),this.mutatedKeys=ta(),this.Gu=io(e),this.Qu=new Ah(this.Gu)}get ju(){return this.qu}Wu(e,t){const n=t?t.zu:new Ch,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=no(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||c&&this.Gu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:o,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ir()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const s=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.Uu;return this.Uu=o,0!==i.length||a?{snapshot:new Dh(this.query,e.Qu,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Ch,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.qu=this.qu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.qu=this.qu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=ta(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new $h(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new jh(n))})),t}tc(e){this.qu=e.Hi,this.Ku=ta();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Dh.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Kh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class zh{constructor(e){this.key=e,this.nc=!1}}class Wh{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new Go((e=>eo(e)),Zs),this.rc=new Map,this.oc=new Set,this.uc=new Es(Kr.comparator),this.cc=new Map,this.ac=new Qu,this.hc={},this.lc=new Map,this.fc=Su.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function Hh(e,t){const n=Id(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await wl(n.localStore,Ys(t));n.isPrimaryClient&&Zl(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Qh(n,t,r,"current"===s,e.resumeToken)}return i}async function Qh(e,t,n,r,i){e._c=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await bl(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return od(e,t.targetId,o.Xu),o.snapshot}(e,t,n,r);const s=await bl(e.localStore,t,!0),o=new Gh(t,s.Hi),a=o.Wu(s.documents),c=sa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);od(e,n,u.Xu);const l=new Kh(t,n,o);return e.ic.set(t,l),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}async function Yh(e,t){const n=_r(e),r=n.ic.get(t),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter((e=>!Zs(e,t)))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Il(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),eh(n.remoteStore,r.targetId),id(n,r.targetId)})).catch(ri)):(id(n,r.targetId),await Il(n.localStore,r.targetId,!0))}async function Xh(e,t){const n=_r(e);try{const e=await function(e,t){const n=_r(e),r=t.snapshotVersion;let i=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.qi;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Si.EMPTY_BYTE_STRING,qr.min()).withLastLimboFreeSnapshotVersion(qr.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Cs.updateTargetData(e,u))}));let a=zo(),c=ta();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(yl(e,s,t.documentUpdates).next((e=>{a=e.Wi,c=e.zi}))),!r.isEqual(qr.min())){const t=n.Cs.getLastRemoteSnapshotVersion(e).next((t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ii.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.qi=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.cc.get(t);r&&(br(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.nc=!0:e.modifiedDocuments.size>0?br(r.nc):e.removedDocuments.size>0&&(br(r.nc),r.nc=!1))})),await ud(n,e,t)}catch(e){await ri(e)}}function Jh(e,t,n){const r=_r(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ic.forEach(((n,r)=>{const i=r.view.bu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=_r(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.bu(t)&&(r=!0)})),r&&Mh(n)}(r.eventManager,t),e.length&&r.sc.Wo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Zh(e,t,n){const r=_r(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.cc.get(t),s=i&&i.key;if(s){let e=new Es(Kr.comparator);e=e.insert(s,Os.newNoDocument(s,qr.min()));const n=ta().add(s),i=new ia(qr.min(),new Map,new As(Mr),e,n);await Xh(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),cd(r)}else await Il(r.localStore,t,!1).then((()=>id(r,t,n))).catch(ri)}async function ed(e,t){const n=_r(e),r=t.batch.batchId;try{const e=await function(e,t){const n=_r(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ii.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);br(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ta();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);rd(n,r,null),nd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ud(n,e)}catch(e){await ri(e)}}async function td(e,t,n){const r=_r(e);try{const e=await function(e,t){const n=_r(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(br(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);rd(r,t,n),nd(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await ud(r,e)}catch(n){await ri(n)}}function nd(e,t){(e.lc.get(t)||[]).forEach((e=>{e.resolve()})),e.lc.delete(t)}function rd(e,t,n){const r=_r(e);let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function id(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.rc.get(t))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach((t=>{e.ac.containsKey(t)||sd(e,t)}))}function sd(e,t){e.oc.delete(t.path.canonicalString());const n=e.uc.get(t);null!==n&&(eh(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),cd(e))}function od(e,t,n){for(const r of n)r instanceof jh?(e.ac.addReference(r.key,t),ad(e,r)):r instanceof $h?(gr("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||sd(e,r.key)):Ir()}function ad(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(gr("SyncEngine","New document in limbo: "+n),e.oc.add(r),cd(e))}function cd(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){const t=e.oc.values().next().value;e.oc.delete(t);const n=new Kr(jr.fromString(t)),r=e.fc.next();e.cc.set(r,new zh(n)),e.uc=e.uc.insert(n,r),Zl(e.remoteStore,new Tc(Ys(Gs(n.path)),r,2,gi.at))}}async function ud(e,t,n){const r=_r(e),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach(((e,a)=>{o.push(r._c(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=hl.Ci(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.sc.Wo(i),await async function(e,t){const n=_r(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ii.forEach(t,(t=>ii.forEach(t.Si,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ii.forEach(t.Di,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ui(e))throw e;gr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.qi.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.qi=n.qi.insert(t,i)}}}(r.localStore,s))}async function ld(e,t){const n=_r(e);if(!n.currentUser.isEqual(t)){gr("SyncEngine","User change. New user:",t.toKey());const e=await ml(n.localStore,t);n.currentUser=t,function(e,t){e.lc.forEach((e=>{e.forEach((e=>{e.reject(new Er(Tr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.lc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ud(n,e.ji)}}function hd(e,t){const n=_r(e),r=n.cc.get(t);if(r&&r.nc)return ta().add(r.key);{let e=ta();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}async function dd(e,t){const n=_r(e),r=await bl(n.localStore,t.query,!0),i=t.view.tc(r);return n.isPrimaryClient&&od(n,t.targetId,i.Xu),i}async function fd(e,t){const n=_r(e);return Tl(n.localStore,t).then((e=>ud(n,e)))}async function pd(e,t,n,r){const i=_r(e),s=await function(e,t){const n=_r(e),r=_r(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Tn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ii.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await dh(i.remoteStore):"acknowledged"===n||"rejected"===n?(rd(i,t,r||null),nd(i,t),function(e,t){_r(_r(e).mutationQueue).An(t)}(i.localStore,t)):Ir(),await ud(i,s)):gr("SyncEngine","Cannot apply mutation batch with id: "+t)}async function md(e,t,n){const r=_r(e),i=[],s=[];for(const e of t){let t;const n=r.rc.get(e);if(n&&0!==n.length){t=await wl(r.localStore,Ys(n[0]));for(const e of n){const t=r.ic.get(e),n=await dd(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await _l(r.localStore,e);t=await wl(r.localStore,n),await Qh(r,gd(n),e,!1,t.resumeToken)}i.push(t)}return r.sc.Wo(s),i}function gd(e){return $s(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function yd(e){const t=_r(e);return _r(_r(t.localStore).persistence).vi()}async function vd(e,t,n,r){const i=_r(e);if(i.dc)return void gr("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Tl(i.localStore,ro(s[0])),r=ia.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Si.EMPTY_BYTE_STRING);await ud(i,e,r);break}case"rejected":await Il(i.localStore,t,!0),id(i,t,r);break;default:Ir()}}async function wd(e,t,n){const r=Id(e);if(r.dc){for(const e of t){if(r.rc.has(e)){gr("SyncEngine","Adding an already active target "+e);continue}const t=await _l(r.localStore,e),n=await wl(r.localStore,t);await Qh(r,gd(t),n.targetId,!1,n.resumeToken),Zl(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await Il(r.localStore,e,!1).then((()=>{eh(r.remoteStore,e),id(r,e)})).catch(ri)}}function Id(e){const t=_r(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zh.bind(null,t),t.sc.Wo=Ph.bind(null,t.eventManager),t.sc.wc=Lh.bind(null,t.eventManager),t}function bd(e){const t=_r(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ed.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=td.bind(null,t),t}class _d{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=$l(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return pl(this.persistence,new dl,e.initialUser,this.yt)}yc(e){return new tl(rl.Bs,this.yt)}gc(e){return new Ll}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Td extends _d{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await bd(this.Ac.syncEngine),await dh(this.Ac.remoteStore),await this.persistence.li((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ic(e){return pl(this.persistence,new dl,e.initialUser,this.yt)}Tc(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new xu(n,e.asyncQueue,t)}Ec(e,t){const n=new mi(t,this.persistence);return new pi(e.asyncQueue,n)}yc(e){const t=ll(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?yu.withCacheSize(this.cacheSizeBytes):yu.DEFAULT;return new al(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Bl(),jl(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Ll}}class Ed extends Td{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof Pl&&(this.sharedClientState.syncEngine={Fr:pd.bind(null,t),$r:vd.bind(null,t),Br:wd.bind(null,t),vi:yd.bind(null,t),Mr:fd.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li((async e=>{await async function(e,t){const n=_r(e);if(Id(n),bd(n),!0===t&&!0!==n.dc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await md(n,e.toArray());n.dc=!0,await _h(n.remoteStore,!0);for(const e of t)Zl(n.remoteStore,e)}else if(!1===t&&!1!==n.dc){const e=[];let t=Promise.resolve();n.rc.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(id(n,i),Il(n.localStore,i,!0)))),eh(n.remoteStore,i)})),await t,await md(n,e),function(e){const t=_r(e);t.cc.forEach(((e,n)=>{eh(t.remoteStore,n)})),t.ac.fs(),t.cc=new Map,t.uc=new Es(Kr.comparator)}(n),n.dc=!1,await _h(n.remoteStore,!1)}}(this.Ac.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}gc(e){const t=Bl();if(!Pl.C(t))throw new Er(Tr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=ll(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Pl(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Sd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Jh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ld.bind(null,this.syncEngine),await _h(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Rh}createDatastore(e){const t=$l(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new ql(r));var r;return function(e,t,n,r){return new Hl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Jh(this.syncEngine,e,0),s=Fl.C()?new Fl:new Ml,new Yl(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Wh(e,t,n,r,i,s);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=_r(e);gr("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Jl(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function kd(e,t,n){if(!n)throw new Er(Tr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Ad(e,t,n,r){if(!0===t&&!0===r)throw new Er(Tr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Cd(e){if(!Kr.isDocumentKey(e))throw new Er(Tr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Dd(e){if(Kr.isDocumentKey(e))throw new Er(Tr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Nd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ir()}function Rd(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Er(Tr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Nd(e);throw new Er(Tr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function xd(e,t){if(t<=0)throw new Er(Tr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const Od=new Map;class Pd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Er(Tr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Er(Tr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Ad("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ld{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Er(Tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Er(Tr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ar;switch(e.type){case"gapi":const t=e.client;return new Rr(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Er(Tr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Od.get(e);t&&(gr("ComponentProvider","Removing Datastore"),Od.delete(e),t.terminate())}(this),Promise.resolve()}}function Md(e,t,n,r={}){var i;const s=(e=Rd(e,Ld))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&vr("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=dr.MOCK_USER;else{t=(0,c.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Er(Tr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new dr(s)}e._authCredentials=new Cr(new kr(t,n))}}class Fd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Fd(this.firestore,e,this._key)}}class Ud{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ud(this.firestore,e,this._query)}}class Vd extends Ud{constructor(e,t,n){super(e,t,Gs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Fd(this.firestore,null,new Kr(e))}withConverter(e){return new Vd(this.firestore,e,this._path)}}function qd(e,t,...n){if(e=(0,c.m9)(e),kd("collection","path",t),e instanceof Ld){const r=jr.fromString(t,...n);return Dd(r),new Vd(e,null,r)}{if(!(e instanceof Fd||e instanceof Vd))throw new Er(Tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(jr.fromString(t,...n));return Dd(r),new Vd(e.firestore,null,r)}}function Bd(e,t,...n){if(e=(0,c.m9)(e),1===arguments.length&&(t=Lr.R()),kd("doc","path",t),e instanceof Ld){const r=jr.fromString(t,...n);return Cd(r),new Fd(e,null,new Kr(r))}{if(!(e instanceof Fd||e instanceof Vd))throw new Er(Tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(jr.fromString(t,...n));return Cd(r),new Fd(e.firestore,e instanceof Vd?e.converter:null,new Kr(r))}}function jd(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),(e instanceof Fd||e instanceof Vd)&&(t instanceof Fd||t instanceof Vd)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function $d(e,t){return e=(0,c.m9)(e),t=(0,c.m9)(t),e instanceof Ud&&t instanceof Ud&&e.firestore===t.firestore&&Zs(e._query,t._query)&&e.converter===t.converter}function Gd(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Kd{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):yr("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class zd{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Sr,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then((e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.ku)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(null===e)return null;const t=this.vc.decode(e),n=Number(t);isNaN(n)&&this.Dc(`length string (${t}) is not valid number`);const r=await this.Cc(n);return new Uh(JSON.parse(r),e.length+n)}xc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Wd{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Er(Tr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=_r(e),r=Aa(n.yt)+"/documents",i={documents:t.map((e=>Ta(n.yt,e)))},s=await n._o("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){br(!!t.found),t.found.name,t.found.updateTime;const n=Ea(e,t.found.name),r=Ia(t.found.updateTime),i=t.found.createTime?Ia(t.found.createTime):qr.min(),s=new Rs({mapValue:{fields:t.found.fields}});return Os.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){br(!!t.missing),br(!!t.readTime);const n=Ea(e,t.missing),r=Ia(t.readTime);return Os.newNoDocument(n,r)}(e,t):Ir()}(n.yt,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());br(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=Kr.fromPath(t);this.mutations.push(new Uo(n,this.precondition(n)))})),await async function(e,t){const n=_r(e),r=Aa(n.yt)+"/documents",i={writes:t.map((e=>Ra(n.yt,e)))};await n.ao("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ir();t=qr.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Er(Tr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(qr.min())?Eo.exists(!1):Eo.updateTime(t):Eo.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(qr.min()))throw new Er(Tr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Eo.updateTime(t)}return Eo.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Hd{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new Gl(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro((async()=>{const e=new Wd(this.datastore),t=this.Mc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Fc(e)}))))})).catch((e=>{this.Fc(e)}))}))}Mc(e){try{const t=this.updateFunction(e);return!_i(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Oc(),Promise.resolve())))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!jo(t)}return!1}}class Qd{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=dr.UNAUTHENTICATED,this.clientId=Lr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{gr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(gr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Er(Tr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Sr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=kh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Yd(e,t){e.asyncQueue.verifyOperationInProgress(),gr("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await ml(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function Xd(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Jd(e);gr("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>bh(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>bh(t.remoteStore,n))),e.onlineComponents=t}async function Jd(e){return e.offlineComponents||(gr("FirestoreClient","Using default OfflineComponentProvider"),await Yd(e,new _d)),e.offlineComponents}async function Zd(e){return e.onlineComponents||(gr("FirestoreClient","Using default OnlineComponentProvider"),await Xd(e,new Sd)),e.onlineComponents}function ef(e){return Jd(e).then((e=>e.persistence))}function tf(e){return Jd(e).then((e=>e.localStore))}function nf(e){return Zd(e).then((e=>e.remoteStore))}function rf(e){return Zd(e).then((e=>e.syncEngine))}function sf(e){return Zd(e).then((e=>e.datastore))}async function of(e){const t=await Zd(e),n=t.eventManager;return n.onListen=Hh.bind(null,t.syncEngine),n.onUnlisten=Yh.bind(null,t.syncEngine),n}function af(e,t,n={}){const r=new Sr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Kd({next:s=>{t.enqueueAndForget((()=>Oh(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Er(Tr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Er(Tr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Fh(Gs(n.path),s,{includeMetadataChanges:!0,Nu:!0});return xh(e,o)}(await of(e),e.asyncQueue,t,n,r))),r.promise}function cf(e,t,n={}){const r=new Sr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Kd({next:n=>{t.enqueueAndForget((()=>Oh(e,o))),n.fromCache&&"server"===r.source?i.reject(new Er(Tr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Fh(n,s,{includeMetadataChanges:!0,Nu:!0});return xh(e,o)}(await of(e),e.asyncQueue,t,n,r))),r.promise}function uf(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new zd(e,t)}(function(e,t){if(e instanceof Uint8Array)return Gd(e,t);if(e instanceof ArrayBuffer)return Gd(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,$l(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=_r(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=_r(e),r=Ia(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ns.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Bh(r));const i=new qh(r,e.localStore,t.yt);let s=await t.mc();for(;s;){const e=await i.Fu(s);e&&n._updateProgress(e),s=await t.mc()}const o=await i.complete();return await ud(e,o.Lu,void 0),await function(e,t){const n=_r(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ns.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(e){return vr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await rf(e),i,r)}))}class lf{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Gl(this,"async_queue_retry"),this.Wc=()=>{const e=jl();e&&gr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=jl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=jl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise((()=>{}));const t=new Sr;return this.Hc((()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Lc.push(e),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!ui(e))throw e;gr("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(e){const t=this.Bc.then((()=>(this.Gc=!0,e().catch((e=>{this.Kc=e,this.Gc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw yr("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Gc=!1,e))))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=Sh.createAndSchedule(this,e,t,n,(e=>this.Yc(e)));return this.Uc.push(r),r}zc(){this.Kc&&Ir()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then((()=>{this.Uc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()}))}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function hf(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class df{constructor(){this._progressObserver={},this._taskCompletionResolver=new Sr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ff extends Ld{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||mf(this),this._firestoreClient.terminate()}}function pf(e){return e._firestoreClient||mf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function mf(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new yi(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Qd(e._authCredentials,e._appCheckCredentials,e._queue,r)}function gf(e,t,n){const r=new Sr;return e.asyncQueue.enqueue((async()=>{try{await Yd(e,n),await Xd(e,t),r.resolve()}catch(e){const t=e;if(!function(e){return"FirebaseError"===e.name?e.code===Tr.FAILED_PRECONDITION||e.code===Tr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(t))throw t;vr("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function yf(e){return function(e){const t=new Sr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=_r(e);sh(n.remoteStore)||gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=_r(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=kh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await rf(e),t))),t.promise}(pf(e=Rd(e,ff)))}function vf(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await ef(e),n=await nf(e);return t.setNetworkEnabled(!0),function(e){const t=_r(e);return t._u.delete(0),Xl(t)}(n)}))}(pf(e=Rd(e,ff)))}function wf(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await ef(e),n=await nf(e);return t.setNetworkEnabled(!1),async function(e){const t=_r(e);t._u.add(0),await Jl(t),t.gu.set("Offline")}(n)}))}(pf(e=Rd(e,ff)))}function If(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=_r(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ns.getNamedQuery(e,t)))}(await tf(e),t)))}(pf(e=Rd(e,ff)),t).then((t=>t?new Ud(e,null,t.query):null))}function bf(e){if(e._initialized||e._terminated)throw new Er(Tr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class _f{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _f(Si.fromBase64String(e))}catch(e){throw new Er(Tr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new _f(Si.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Tf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Er(Tr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ef{constructor(e){this._methodName=e}}class Sf{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Er(Tr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Er(Tr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Mr(this._lat,e._lat)||Mr(this._long,e._long)}}const kf=/^__.*__$/;class Af{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Oo(e,this.data,this.fieldMask,t,this.fieldTransforms):new xo(e,this.data,t,this.fieldTransforms)}}class Cf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Oo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Df(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ir()}}class Nf{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Nf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Yf(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Df(this.sa)&&kf.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Rf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||$l(e)}da(e,t,n,r=!1){return new Nf({sa:e,methodName:t,fa:n,path:Gr.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function xf(e){const t=e._freezeSettings(),n=$l(e._databaseId);return new Rf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Of(e,t,n,r,i,s={}){const o=e.da(s.merge||s.mergeFields?2:0,t,n,i);zf("Data must be an object, but it was:",o,r);const a=Gf(r,o);let c,u;if(s.merge)c=new Ns(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Wf(t,r,n);if(!o.contains(i))throw new Er(Tr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Xf(e,i)||e.push(i)}c=new Ns(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Af(new Rs(a),c,u)}class Pf extends Ef{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Pf}}function Lf(e,t,n){return new Nf({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class Mf extends Ef{_toFieldTransform(e){return new _o(e.path,new po)}isEqual(e){return e instanceof Mf}}class Ff extends Ef{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Lf(this,e,!0),n=this._a.map((e=>$f(e,t))),r=new mo(n);return new _o(e.path,r)}isEqual(e){return this===e}}class Uf extends Ef{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Lf(this,e,!0),n=this._a.map((e=>$f(e,t))),r=new yo(n);return new _o(e.path,r)}isEqual(e){return this===e}}class Vf extends Ef{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new wo(e.yt,co(e.yt,this.wa));return new _o(e.path,t)}isEqual(e){return this===e}}function qf(e,t,n,r){const i=e.da(1,t,n);zf("Data must be an object, but it was:",i,r);const s=[],o=Rs.empty();Ii(r,((e,r)=>{const a=Qf(t,e,n);r=(0,c.m9)(r);const u=i.ca(a);if(r instanceof Pf)s.push(a);else{const e=$f(r,u);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Ns(s);return new Cf(o,a,i.fieldTransforms)}function Bf(e,t,n,r,i,s){const o=e.da(1,t,n),a=[Wf(t,r,n)],u=[i];if(s.length%2!=0)throw new Er(Tr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(Wf(t,s[e])),u.push(s[e+1]);const l=[],h=Rs.empty();for(let e=a.length-1;e>=0;--e)if(!Xf(l,a[e])){const t=a[e];let n=u[e];n=(0,c.m9)(n);const r=o.ca(t);if(n instanceof Pf)l.push(t);else{const e=$f(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new Ns(l);return new Cf(h,d,o.fieldTransforms)}function jf(e,t,n,r=!1){return $f(n,e.da(r?4:3,t))}function $f(e,t){if(Kf(e=(0,c.m9)(e)))return zf("Unsupported field value:",t,e),Gf(e,t);if(e instanceof Ef)return function(e,t){if(!Df(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=$f(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return co(t.yt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Vr.fromDate(e);return{timestampValue:ya(t.yt,n)}}if(e instanceof Vr){const n=new Vr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ya(t.yt,n)}}if(e instanceof Sf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof _f)return{bytesValue:va(t.yt,e._byteString)};if(e instanceof Fd){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ba(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha(`Unsupported field value: ${Nd(e)}`)}(e,t)}function Gf(e,t){const n={};return bi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ii(e,((e,r)=>{const i=$f(r,t.ra(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Kf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Vr||e instanceof Sf||e instanceof _f||e instanceof Fd||e instanceof Ef)}function zf(e,t,n){if(!Kf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Nd(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function Wf(e,t,n){if((t=(0,c.m9)(t))instanceof Tf)return t._internalPath;if("string"==typeof t)return Qf(e,t);throw Yf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Hf=new RegExp("[~\\*/\\[\\]]");function Qf(e,t,n){if(t.search(Hf)>=0)throw Yf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tf(...t.split("."))._internalPath}catch(r){throw Yf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Yf(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Er(Tr.INVALID_ARGUMENT,a+e+c)}function Xf(e,t){return e.some((e=>e.isEqual(t)))}class Jf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Fd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Zf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ep("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Zf extends Jf{data(){return super.data()}}function ep(e,t){return"string"==typeof t?Qf(e,t):t instanceof Tf?t._internalPath:t._delegate._internalPath}function tp(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Er(Tr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class np{}class rp extends np{}function ip(e,t,...n){let r=[];t instanceof np&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof op)).length,n=e.filter((e=>e instanceof sp)).length;if(t>1||t>0&&n>0)throw new Er(Tr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class sp extends rp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sp(e,t,n)}_apply(e){const t=this._parse(e);return pp(e._query,t),new Ud(e.firestore,e.converter,Xs(e._query,t))}_parse(e){const t=xf(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Er(Tr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){fp(o,s);const t=[];for(const n of o)t.push(dp(r,e,n));a={arrayValue:{values:t}}}else a=dp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||fp(o,s),a=jf(n,"where",o,"in"===s||"not-in"===s);return is.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class op extends np{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new op(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:ss.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)pp(n,e),n=Xs(n,e)}(e._query,t),new Ud(e.firestore,e.converter,Xs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ap extends rp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ap(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Er(Tr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Er(Tr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new _s(t,n);return function(e,t){if(null===zs(e)){const n=Ws(e);null!==n&&mp(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Ud(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new js(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class cp extends rp{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new cp(e,t,n)}_apply(e){return new Ud(e.firestore,e.converter,Js(e._query,this._limit,this._limitType))}}class up extends rp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new up(e,t,n)}_apply(e){const t=hp(e,this.type,this._docOrFields,this._inclusive);return new Ud(e.firestore,e.converter,function(e,t){return new js(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class lp extends rp{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new lp(e,t,n)}_apply(e){const t=hp(e,this.type,this._docOrFields,this._inclusive);return new Ud(e.firestore,e.converter,function(e,t){return new js(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function hp(e,t,n,r){if(n[0]=(0,c.m9)(n[0]),n[0]instanceof Jf)return function(e,t,n,r,i){if(!r)throw new Er(Tr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Qs(e))if(n.field.isKeyField())s.push(ji(t,r.key));else{const e=r.data.field(n.field);if(Ni(e))throw new Er(Tr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new es(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=xf(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Er(Tr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Hs(e)&&-1!==c.indexOf("/"))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(jr.fromString(c));if(!Kr.isDocumentKey(n))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Kr(n);a.push(ji(t,i))}else{const e=jf(n,r,c);a.push(e)}}return new es(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function dp(e,t,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new Er(Tr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hs(t)&&-1!==n.indexOf("/"))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(jr.fromString(n));if(!Kr.isDocumentKey(r))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ji(e,new Kr(r))}if(n instanceof Fd)return ji(e,n._key);throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nd(n)}.`)}function fp(e,t){if(!Array.isArray(e)||0===e.length)throw new Er(Tr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Er(Tr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function pp(e,t){if(t.isInequality()){const n=Ws(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=zs(e);null!==i&&mp(e,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Er(Tr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Er(Tr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function mp(e,t,n){if(!n.isEqual(t))throw new Er(Tr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class gp{convertValue(e,t="none"){switch(Li(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ci(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Di(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ir()}}convertObject(e,t){const n={};return Ii(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Sf(Ci(e.latitude),Ci(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ri(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xi(e));default:return null}}convertTimestamp(e){const t=Ai(e);return new Vr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=jr.fromString(e);br(Ga(n));const r=new vi(n.get(1),n.get(3)),i=new Kr(n.popFirst(5));return r.isEqual(t)||yr(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function yp(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class vp extends gp{constructor(e){super(),this.firestore=e}convertBytes(e){return new _f(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fd(this.firestore,null,t)}}class wp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ip extends Jf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ep("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class bp extends Ip{data(e={}){return super.data(e)}}class _p{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new wp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new bp(this._firestore,this._userDataWriter,n.key,n,new wp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Er(Tr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new bp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new wp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new bp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new wp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Tp(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Tp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ir()}}function Ep(e,t){return e instanceof Ip&&t instanceof Ip?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _p&&t instanceof _p&&e._firestore===t._firestore&&$d(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class Sp extends gp{constructor(e){super(),this.firestore=e}convertBytes(e){return new _f(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fd(this.firestore,null,t)}}function kp(e){e=Rd(e,Fd);const t=Rd(e.firestore,ff),n=pf(t),r=new Sp(t);return function(e,t){const n=new Sr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=_r(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Er(Tr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=kh(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await tf(e),t,n))),n.promise}(n,e._key).then((n=>new Ip(t,r,e._key,n,new wp(null!==n&&n.hasLocalMutations,!0),e.converter)))}function Ap(e){e=Rd(e,Ud);const t=Rd(e.firestore,ff),n=pf(t),r=new Sp(t);return function(e,t){const n=new Sr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await bl(e,t,!0),i=new Gh(t,r.Hi),s=i.Wu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=kh(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await tf(e),t,n))),n.promise}(n,e._query).then((n=>new _p(t,r,e,n)))}function Cp(e,t,n){e=Rd(e,Fd);const r=Rd(e.firestore,ff),i=yp(e.converter,t,n);return xp(r,[Of(xf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Eo.none())])}function Dp(e,t,n,...r){e=Rd(e,Fd);const i=Rd(e.firestore,ff),s=xf(i);let o;return o="string"==typeof(t=(0,c.m9)(t))||t instanceof Tf?Bf(s,"updateDoc",e._key,t,n,r):qf(s,"updateDoc",e._key,t),xp(i,[o.toMutation(e._key,Eo.exists(!0))])}function Np(e,...t){var n,r,i;e=(0,c.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||hf(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(hf(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,h;if(e instanceof Fd)l=Rd(e.firestore,ff),h=Gs(e._key.path),u={next:n=>{t[o]&&t[o](Op(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Rd(e,Ud);l=Rd(n.firestore,ff),h=n._query;const r=new Sp(l);u={next:e=>{t[o]&&t[o](new _p(l,r,n,e))},error:t[o+1],complete:t[o+2]},tp(e._query)}return function(e,t,n,r){const i=new Kd(r),s=new Fh(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>xh(await of(e),s))),()=>{i.bc(),e.asyncQueue.enqueueAndForget((async()=>Oh(await of(e),s)))}}(pf(l),h,a,u)}function Rp(e,t){return function(e,t){const n=new Kd(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){_r(e).Ru.add(t),t.next()}(await of(e),n))),()=>{n.bc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){_r(e).Ru.delete(t)}(await of(e),n)))}}(pf(e=Rd(e,ff)),hf(t)?t:{next:t})}function xp(e,t){return function(e,t){const n=new Sr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=bd(e);try{const e=await function(e,t){const n=_r(e),r=Vr.now(),i=t.reduce(((e,t)=>e.add(t.key)),ta());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=zo(),c=ta();return n.Gi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=No(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Oo(e.key,t,xs(t.value.mapValue),Eo.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Qo(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r||(r=new Es(Mr)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await ud(r,e.changes),await dh(r.remoteStore)}catch(e){const t=kh(e,"Failed to persist write");n.reject(t)}}(await rf(e),t,n))),n.promise}(pf(e),t)}function Op(e,t,n){const r=n.docs.get(t._key),i=new Sp(e);return new Ip(e,i,t._key,r,new wp(n.hasPendingWrites,n.fromCache),t.converter)}const Pp={maxAttempts:5};class Lp{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xf(e)}set(e,t,n){this._verifyNotCommitted();const r=Mp(e,this._firestore),i=yp(r.converter,t,n),s=Of(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Eo.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Mp(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof Tf?Bf(this._dataReader,"WriteBatch.update",i._key,t,n,r):qf(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Eo.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Mp(e,this._firestore);return this._mutations=this._mutations.concat(new Fo(t._key,Eo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Er(Tr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Mp(e,t){if((e=(0,c.m9)(e)).firestore!==t)throw new Er(Tr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Fp extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=xf(e)}get(e){const t=Mp(e,this._firestore),n=new vp(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Ir();const r=e[0];if(r.isFoundDocument())return new Jf(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Jf(this._firestore,n,t._key,null,t.converter);throw Ir()}))}set(e,t,n){const r=Mp(e,this._firestore),i=yp(r.converter,t,n),s=Of(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Mp(e,this._firestore);let s;return s="string"==typeof(t=(0,c.m9)(t))||t instanceof Tf?Bf(this._dataReader,"Transaction.update",i._key,t,n,r):qf(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Mp(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Mp(e,this._firestore),n=new Sp(this._firestore);return super.get(e).then((e=>new Ip(this._firestore,n,t._key,e._document,new wp(!1,!1),t.converter)))}}!function(e,t=!0){!function(e){fr=e}(s.SDK_VERSION),(0,s._registerComponent)(new o.wA("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new ff(new Dr(e.getProvider("auth-internal")),new Or(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Er(Tr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vi(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,s.registerVersion)(hr,"3.8.3",e),(0,s.registerVersion)(hr,"3.8.3","esm2017")}();function Up(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Er("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function Vp(){if("undefined"==typeof Uint8Array)throw new Er("unimplemented","Uint8Arrays are not available in this environment.")}function qp(){if("undefined"==typeof atob)throw new Er("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Bp{constructor(e){this._delegate=e}static fromBase64String(e){return qp(),new Bp(_f.fromBase64String(e))}static fromUint8Array(e){return Vp(),new Bp(_f.fromUint8Array(e))}toBase64(){return qp(),this._delegate.toBase64()}toUint8Array(){return Vp(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function jp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class $p{enableIndexedDbPersistence(e,t){return function(e,t){bf(e=Rd(e,ff));const n=pf(e),r=e._freezeSettings(),i=new Sd;return gf(n,i,new Td(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){bf(e=Rd(e,ff));const t=pf(e),n=e._freezeSettings(),r=new Sd;return gf(t,r,new Ed(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Er(Tr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Sr;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!oi.C())return Promise.resolve();const t=e+"main";await oi.delete(t)}(ll(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class Gp{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof vi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||vr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Md(this._delegate,e,t,n)}enableNetwork(){return vf(this._delegate)}disableNetwork(){return wf(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Ad("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return yf(this._delegate)}onSnapshotsInSync(e){return Rp(this._delegate,e)}get app(){if(!this._appCompat)throw new Er("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new im(this,qd(this._delegate,e))}catch(e){throw Yp(e,"collection()","Firestore.collection()")}}doc(e){try{return new Qp(this,Bd(this._delegate,e))}catch(e){throw Yp(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new tm(this,function(e,t){if(e=Rd(e,Ld),kd("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Er(Tr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ud(e,null,function(e){return new js(jr.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw Yp(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Rd(e,ff);const r=Object.assign(Object.assign({},Pp),n);return function(e){if(e.maxAttempts<1)throw new Er(Tr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Sr;return e.asyncQueue.enqueueAndForget((async()=>{const i=await sf(e);new Hd(e.asyncQueue,i,n,t,r).run()})),r.promise}(pf(e),(n=>t(new Fp(e,n))),r)}(this._delegate,(t=>e(new zp(this,t))))}batch(){return pf(this._delegate),new Wp(new Lp(this._delegate,(e=>xp(this._delegate,e))))}loadBundle(e){return function(e,t){const n=pf(e=Rd(e,ff)),r=new df;return uf(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return If(this._delegate,e).then((e=>e?new tm(this,e):null))}}class Kp extends gp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bp(new _f(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Qp.forKey(t,this.firestore,null)}}class zp{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Kp(e)}get(e){const t=sm(e);return this._delegate.get(t).then((e=>new Zp(this._firestore,new Ip(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=sm(e);return n?(Up("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=sm(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=sm(e);return this._delegate.delete(t),this}}class Wp{constructor(e){this._delegate=e}set(e,t,n){const r=sm(e);return n?(Up("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=sm(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=sm(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Hp{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new bp(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new em(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Hp.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Hp(e,new Kp(e),t),r.set(t,i)),i}}Hp.INSTANCES=new WeakMap;class Qp{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Kp(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Er("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Qp(t,new Fd(t._delegate,n,new Kr(e)))}static forKey(e,t,n){return new Qp(t,new Fd(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new im(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new im(this.firestore,qd(this._delegate,e))}catch(e){throw Yp(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,c.m9)(e))instanceof Fd&&jd(this._delegate,e)}set(e,t){t=Up("DocumentReference.set",t);try{return t?Cp(this._delegate,e,t):Cp(this._delegate,e)}catch(e){throw Yp(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Dp(this._delegate,e):Dp(this._delegate,e,t,...n)}catch(e){throw Yp(e,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return xp(Rd(e.firestore,ff),[new Fo(e._key,Eo.none())])}(this._delegate)}onSnapshot(...e){const t=Xp(e),n=Jp(e,(e=>new Zp(this.firestore,new Ip(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Np(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?kp(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Rd(e,Fd);const t=Rd(e.firestore,ff);return af(pf(t),e._key,{source:"server"}).then((n=>Op(t,e,n)))}(this._delegate):function(e){e=Rd(e,Fd);const t=Rd(e.firestore,ff);return af(pf(t),e._key).then((n=>Op(t,e,n)))}(this._delegate),t.then((e=>new Zp(this.firestore,new Ip(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new Qp(this.firestore,e?this._delegate.withConverter(Hp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Yp(e,t,n){return e.message=e.message.replace(t,n),e}function Xp(e){for(const t of e)if("object"==typeof t&&!jp(t))return t;return{}}function Jp(e,t){var n,r;let i;return i=jp(e[0])?e[0]:jp(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Zp{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Qp(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ep(this._delegate,e._delegate)}}class em extends Zp{data(e){const t=this._delegate.data(e);return function(e,t){e||Ir()}(void 0!==t),t}}class tm{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Kp(e)}where(e,t,n){try{return new tm(this.firestore,ip(this._delegate,function(e,t,n){const r=t,i=ep("where",e);return sp._create(i,r,n)}(e,t,n)))}catch(e){throw Yp(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new tm(this.firestore,ip(this._delegate,function(e,t="asc"){const n=t,r=ep("orderBy",e);return ap._create(r,n)}(e,t)))}catch(e){throw Yp(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new tm(this.firestore,ip(this._delegate,function(e){return xd("limit",e),cp._create("limit",e,"F")}(e)))}catch(e){throw Yp(e,"limit()","Query.limit()")}}limitToLast(e){try{return new tm(this.firestore,ip(this._delegate,function(e){return xd("limitToLast",e),cp._create("limitToLast",e,"L")}(e)))}catch(e){throw Yp(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new tm(this.firestore,ip(this._delegate,function(...e){return up._create("startAt",e,!0)}(...e)))}catch(e){throw Yp(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new tm(this.firestore,ip(this._delegate,function(...e){return up._create("startAfter",e,!1)}(...e)))}catch(e){throw Yp(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new tm(this.firestore,ip(this._delegate,function(...e){return lp._create("endBefore",e,!1)}(...e)))}catch(e){throw Yp(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new tm(this.firestore,ip(this._delegate,function(...e){return lp._create("endAt",e,!0)}(...e)))}catch(e){throw Yp(e,"endAt()","Query.endAt()")}}isEqual(e){return $d(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Ap(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Rd(e,Ud);const t=Rd(e.firestore,ff),n=pf(t),r=new Sp(t);return cf(n,e._query,{source:"server"}).then((n=>new _p(t,r,e,n)))}(this._delegate):function(e){e=Rd(e,Ud);const t=Rd(e.firestore,ff),n=pf(t),r=new Sp(t);return tp(e._query),cf(n,e._query).then((n=>new _p(t,r,e,n)))}(this._delegate),t.then((e=>new rm(this.firestore,new _p(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=Xp(e),n=Jp(e,(e=>new rm(this.firestore,new _p(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Np(this._delegate,t,n)}withConverter(e){return new tm(this.firestore,e?this._delegate.withConverter(Hp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class nm{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new em(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class rm{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new tm(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new em(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new nm(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new em(this._firestore,n))}))}isEqual(e){return Ep(this._delegate,e._delegate)}}class im extends tm{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Qp(this.firestore,e):null}doc(e){try{return new Qp(this.firestore,void 0===e?Bd(this._delegate):Bd(this._delegate,e))}catch(e){throw Yp(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Rd(e.firestore,ff),r=Bd(e),i=yp(e.converter,t);return xp(n,[Of(xf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Eo.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new Qp(this.firestore,e)))}isEqual(e){return jd(this._delegate,e._delegate)}withConverter(e){return new im(this.firestore,e?this._delegate.withConverter(Hp.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function sm(e){return Rd(e,Fd)}class om{constructor(...e){this._delegate=new Tf(...e)}static documentId(){return new om(Gr.keyField().canonicalString())}isEqual(e){return(e=(0,c.m9)(e))instanceof Tf&&this._delegate._internalPath.isEqual(e._internalPath)}}class am{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Mf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new am(e)}static delete(){const e=new Pf("deleteField");return e._methodName="FieldValue.delete",new am(e)}static arrayUnion(...e){const t=function(...e){return new Ff("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new am(t)}static arrayRemove(...e){const t=function(...e){return new Uf("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new am(t)}static increment(e){const t=function(e){return new Vf("increment",e)}(e);return t._methodName="FieldValue.increment",new am(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const cm={Firestore:Gp,GeoPoint:Sf,Timestamp:Vr,Blob:Bp,Transaction:zp,WriteBatch:Wp,DocumentReference:Qp,DocumentSnapshot:Zp,Query:tm,QueryDocumentSnapshot:em,QuerySnapshot:rm,CollectionReference:im,FieldPath:om,FieldValue:am,setLogLevel:function(e){!function(e){pr.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};var um,lm;um=i.Z,lm=(e,t)=>new Gp(e,t,new $p),um.INTERNAL.registerComponent(new o.wA("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return lm(t,n)}),"PUBLIC").setServiceProps(Object.assign({},cm))),um.registerVersion("@firebase/firestore-compat","0.3.3")},1962:(e,t,n)=>{"use strict";function r(e,t){void 0===t&&(t=e.constructor);var n=Error.captureStackTrace;n&&n(e,t)}var i,s=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});!function(e){function CustomError(t){var n,i,s,o=this.constructor,a=e.call(this,t)||this;return Object.defineProperty(a,"name",{value:o.name,enumerable:!1,configurable:!0}),n=a,i=o.prototype,(s=Object.setPrototypeOf)?s(n,i):n.__proto__=i,r(a),a}s(CustomError,e)}(Error)},90908:(e,t,n)=>{"use strict";new Date}}]);